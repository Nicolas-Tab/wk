{"version":3,"sources":["meteor://ðŸ’»app/packages/peerlibrary:reactive-field/lib.js"],"names":["module","export","ReactiveField","constructor","initialValue","equalsFunc","storePrevious","_","isFunction","arguments","length","previousValue","undefined","value","ReactiveVar","getterSetter","newValue","Tracker","nonreactive","oldValue","get","_isEqual","set","Object","setPrototypeOf","prototype","__proto__","toString","concat","apply","obj","args","call","arg","previous","Error"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAAA,MAAM,CAACC,MAAM,CAAC;EAACC,aAAa,EAACA,CAAA,KAAIA;AAAa,CAAC,CAAC;AAAzC,MAAMA,aAAa,CAAC;EACzBC,WAAWA,CAACC,YAAY,EAAEC,UAAU,EAAEC,aAAa,EAAE;IACnD;IACA,IAAI,CAACC,CAAC,CAACC,UAAU,CAACH,UAAU,CAAC,IAAKI,SAAS,CAACC,MAAM,KAAK,CAAE,EAAE;MACzDJ,aAAa,GAAGD,UAAU;MAC1BA,UAAU,GAAG,IAAI;IACnB;IACA,IAAIM,aAAa,GAAGC,SAAS;IAC7B,MAAMC,KAAK,GAAG,IAAIC,WAAW,CAACV,YAAY,EAAEC,UAAU,CAAC;IAEvD,MAAMU,YAAY,GAAG,SAAAA,CAAUC,QAAQ,EAAE;MACvC,IAAIP,SAAS,CAACC,MAAM,GAAG,CAAC,EAAE;QACxB,IAAIJ,aAAa,EAAE;UACjBW,OAAO,CAACC,WAAW,CAAC,MAAM;YACxB,MAAMC,QAAQ,GAAGN,KAAK,CAACO,GAAG,CAAC,CAAC;YAC5B;YACA,IAAI,CAAC,CAACf,UAAU,IAAIS,WAAW,CAACO,QAAQ,EAAEF,QAAQ,EAAEH,QAAQ,CAAC,EAAE;cAC7DL,aAAa,GAAGQ,QAAQ;YAC1B;UACF,CAAC,CAAC;QACJ;QAEAN,KAAK,CAACS,GAAG,CAACN,QAAQ,CAAC;QACnB;QACA,OAAOC,OAAO,CAACC,WAAW,CAAC,MAAM;UAC/B,OAAOL,KAAK,CAACO,GAAG,CAAC,CAAC;QACpB,CAAC,CAAC;MACJ;MAEA,OAAOP,KAAK,CAACO,GAAG,CAAC,CAAC;IACpB,CAAC;;IAED;IACA,IAAIG,MAAM,CAACC,cAAc,EAAE;MACzBD,MAAM,CAACC,cAAc,CAACT,YAAY,EAAE,IAAI,CAACZ,WAAW,CAACsB,SAAS,CAAC;IACjE,CAAC,MACI;MACHV,YAAY,CAACW,SAAS,GAAG,IAAI,CAACvB,WAAW,CAACsB,SAAS;IACrD;IAEAV,YAAY,CAACY,QAAQ,GAAG,YAAY;MAClC,wBAAAC,MAAA,CAAwB,IAAI,CAAC,CAAC;IAChC,CAAC;IAEDb,YAAY,CAACc,KAAK,GAAG,UAAUC,GAAG,EAAEC,IAAI,EAAE;MACxC,IAAIA,IAAI,IAAIA,IAAI,CAACrB,MAAM,GAAG,CAAC,EAAE;QAC3B,OAAOK,YAAY,CAACgB,IAAI,CAAC,CAAC,CAAC,CAAC;MAC9B,CAAC,MACI;QACH,OAAOhB,YAAY,CAAC,CAAC;MACvB;IACF,CAAC;IAEDA,YAAY,CAACiB,IAAI,GAAG,UAAUF,GAAG,EAAEG,GAAG,EAAE;MACtC,IAAIxB,SAAS,CAACC,MAAM,GAAG,CAAC,EAAE;QACxB,OAAOK,YAAY,CAACkB,GAAG,CAAC;MAC1B,CAAC,MACI;QACH,OAAOlB,YAAY,CAAC,CAAC;MACvB;IACF,CAAC;IAEDA,YAAY,CAACmB,QAAQ,GAAG,YAAW;MACjC,IAAI,CAAC5B,aAAa,EAAE;QAClB,MAAM,IAAI6B,KAAK,CAAC,wCAAwC,CAAC;MAC3D;MACA,OAAOxB,aAAa;IACtB,CAAC;IAED,OAAOI,YAAY;EACrB;AACF,C","file":"/packages/peerlibrary_reactive-field.js","sourcesContent":["export class ReactiveField {\n  constructor(initialValue, equalsFunc, storePrevious) {\n    // To allow not passing equalsFunc, but just storePrevious.\n    if (!_.isFunction(equalsFunc) && (arguments.length === 2)) {\n      storePrevious = equalsFunc;\n      equalsFunc = null;\n    }\n    let previousValue = undefined;\n    const value = new ReactiveVar(initialValue, equalsFunc);\n\n    const getterSetter = function (newValue) {\n      if (arguments.length > 0) {\n        if (storePrevious) {\n          Tracker.nonreactive(() => {\n            const oldValue = value.get();\n            // Only if the new value is different than currently stored value, we update the previous value.\n            if (!(equalsFunc || ReactiveVar._isEqual)(oldValue, newValue)) {\n              previousValue = oldValue;\n            }\n          });\n        }\n\n        value.set(newValue);\n        // We return the value as well, but we do not want to register a dependency.\n        return Tracker.nonreactive(() => {\n          return value.get();\n        });\n      }\n\n      return value.get();\n    };\n\n    // We mingle the prototype so that getterSetter instanceof ReactiveField is true.\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(getterSetter, this.constructor.prototype);\n    }\n    else {\n      getterSetter.__proto__ = this.constructor.prototype;\n    }\n\n    getterSetter.toString = function () {\n      return `ReactiveField{${this()}}`;\n    };\n\n    getterSetter.apply = function (obj, args) {\n      if (args && args.length > 0) {\n        return getterSetter(args[0]);\n      }\n      else {\n        return getterSetter();\n      }\n    };\n\n    getterSetter.call = function (obj, arg) {\n      if (arguments.length > 1) {\n        return getterSetter(arg);\n      }\n      else {\n        return getterSetter();\n      }\n    };\n\n    getterSetter.previous = function() {\n      if (!storePrevious) {\n        throw new Error(\"Storing previous value is not enabled.\");\n      }\n      return previousValue;\n    };\n\n    return getterSetter;\n  }\n}\n"]}