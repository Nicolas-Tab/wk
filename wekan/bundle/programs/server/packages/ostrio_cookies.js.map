{"version":3,"sources":["meteor://ðŸ’»app/packages/ostrio:cookies/cookies.js"],"names":["module","export","Cookies","Meteor","link","v","fetch","WebApp","isServer","require","NoOp","urlRE","rootUrl","process","env","ROOT_URL","window","__meteor_runtime_config__","meteorEnv","mobileRootUrl","MOBILE_ROOT_URL","helpers","isUndefined","obj","isArray","Array","clone","isObject","slice","Object","assign","_helpers","i","length","prototype","toString","call","decode","decodeURIComponent","encode","encodeURIComponent","pairSplitRegExp","fieldContentRegExp","tryDecode","str","d","e","parse","options","Error","opt","val","key","eqIndx","split","forEach","pair","indexOf","substr","trim","unescape","antiCircular","_obj","object","cache","Map","JSON","stringify","value","get","set","serialize","arguments","undefined","name","test","escape","sanitizedValue","stringified","concat","pairs","isNumber","maxAge","push","domain","path","expires","expire","Infinity","Date","toUTCString","httpOnly","secure","firstPartyOnly","sameSite","cookieString","join","isStringifiedRegEx","isTypedRegEx","deserialize","string","match","console","error","__cookies","constructor","opts","__pendingCookies","TTL","response","runOnServer","allowQueryStringCookies","allowedCordovaOrigins","originRE","RegExp","_cookies","cookies","_tmp","hasOwnProperty","isClient","document","cookie","setHeader","remove","keys","has","send","cb","ROOT_URL_PATH_PREFIX","query","isCordova","cookiesKeys","cookiesArray","includes","absoluteUrl","credentials","type","then","catch","__middlewareHandler","request","headers","auto","handler","isFunction","onCookies","isLoadedOnServer","connectHandlers","use","req","res","next","_parsedUrl","matchedCordovaOrigin","origin","matchedOrigin","cookiesObject","___cookies___","writeHead","end","middleware"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAAA,MAAM,CAACC,MAAM,CAAC;EAACC,OAAO,EAACA,CAAA,KAAIA;AAAO,CAAC,CAAC;AAAC,IAAIC,MAAM;AAACH,MAAM,CAACI,IAAI,CAAC,eAAe,EAAC;EAACD,MAAMA,CAACE,CAAC,EAAC;IAACF,MAAM,GAACE,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAEpG,IAAIC,KAAK;AACT,IAAIC,MAAM;AAEV,IAAIJ,MAAM,CAACK,QAAQ,EAAE;EACnBD,MAAM,GAAGE,OAAO,CAAC,eAAe,CAAC,CAACF,MAAM;AAC1C,CAAC,MAAM;EACLD,KAAK,GAAGG,OAAO,CAAC,cAAc,CAAC,CAACH,KAAK;AACvC;AAEA,MAAMI,IAAI,GAAIA,CAAA,KAAM,CAAC,CAAC;AACtB,MAAMC,KAAK,GAAG,qBAAqB;AACnC,MAAMC,OAAO,GAAGT,MAAM,CAACK,QAAQ,GAAGK,OAAO,CAACC,GAAG,CAACC,QAAQ,GAAIC,MAAM,CAACC,yBAAyB,CAACF,QAAQ,IAAIC,MAAM,CAACC,yBAAyB,CAACC,SAAS,CAACH,QAAQ,IAAI,KAAM;AACpK,MAAMI,aAAa,GAAGhB,MAAM,CAACK,QAAQ,GAAGK,OAAO,CAACC,GAAG,CAACM,eAAe,GAAIJ,MAAM,CAACC,yBAAyB,CAACG,eAAe,IAAIJ,MAAM,CAACC,yBAAyB,CAACC,SAAS,CAACE,eAAe,IAAI,KAAM;AAE/L,MAAMC,OAAO,GAAG;EACdC,WAAWA,CAACC,GAAG,EAAE;IACf,OAAOA,GAAG,KAAK,KAAK,CAAC;EACvB,CAAC;EACDC,OAAOA,CAACD,GAAG,EAAE;IACX,OAAOE,KAAK,CAACD,OAAO,CAACD,GAAG,CAAC;EAC3B,CAAC;EACDG,KAAKA,CAACH,GAAG,EAAE;IACT,IAAI,CAAC,IAAI,CAACI,QAAQ,CAACJ,GAAG,CAAC,EAAE,OAAOA,GAAG;IACnC,OAAO,IAAI,CAACC,OAAO,CAACD,GAAG,CAAC,GAAGA,GAAG,CAACK,KAAK,CAAC,CAAC,GAAGC,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAEP,GAAG,CAAC;EACjE;AACF,CAAC;AACD,MAAMQ,QAAQ,GAAG,CAAC,QAAQ,EAAE,QAAQ,EAAE,UAAU,CAAC;AACjD,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGD,QAAQ,CAACE,MAAM,EAAED,CAAC,EAAE,EAAE;EACxCX,OAAO,CAAC,IAAI,GAAGU,QAAQ,CAACC,CAAC,CAAC,CAAC,GAAG,UAAUT,GAAG,EAAE;IAC3C,OAAOM,MAAM,CAACK,SAAS,CAACC,QAAQ,CAACC,IAAI,CAACb,GAAG,CAAC,KAAK,UAAU,GAAGQ,QAAQ,CAACC,CAAC,CAAC,GAAG,GAAG;EAC/E,CAAC;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMK,MAAM,GAAGC,kBAAkB;AACjC,MAAMC,MAAM,GAAGC,kBAAkB;AACjC,MAAMC,eAAe,GAAG,KAAK;;AAE7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMC,kBAAkB,GAAG,uCAAuC;;AAElE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMC,SAAS,GAAGA,CAACC,GAAG,EAAEC,CAAC,KAAK;EAC5B,IAAI;IACF,OAAOA,CAAC,CAACD,GAAG,CAAC;EACf,CAAC,CAAC,OAAOE,CAAC,EAAE;IACV,OAAOF,GAAG;EACZ;AACF,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMG,KAAK,GAAGA,CAACH,GAAG,EAAEI,OAAO,KAAK;EAC9B,IAAI,OAAOJ,GAAG,KAAK,QAAQ,EAAE;IAC3B,MAAM,IAAIzC,MAAM,CAAC8C,KAAK,CAAC,GAAG,EAAE,+BAA+B,CAAC;EAC9D;EACA,MAAM1B,GAAG,GAAG,CAAC,CAAC;EACd,MAAM2B,GAAG,GAAGF,OAAO,IAAI,CAAC,CAAC;EACzB,IAAIG,GAAG;EACP,IAAIC,GAAG;EACP,IAAIC,MAAM;EAEVT,GAAG,CAACU,KAAK,CAACb,eAAe,CAAC,CAACc,OAAO,CAAEC,IAAI,IAAK;IAC3CH,MAAM,GAAGG,IAAI,CAACC,OAAO,CAAC,GAAG,CAAC;IAC1B,IAAIJ,MAAM,GAAG,CAAC,EAAE;MACd;IACF;IACAD,GAAG,GAAGI,IAAI,CAACE,MAAM,CAAC,CAAC,EAAEL,MAAM,CAAC,CAACM,IAAI,CAAC,CAAC;IACnCP,GAAG,GAAGT,SAAS,CAACiB,QAAQ,CAACR,GAAG,CAAC,EAAGF,GAAG,CAACb,MAAM,IAAIA,MAAO,CAAC;IACtDc,GAAG,GAAGK,IAAI,CAACE,MAAM,CAAC,EAAEL,MAAM,EAAEG,IAAI,CAACvB,MAAM,CAAC,CAAC0B,IAAI,CAAC,CAAC;IAC/C,IAAIR,GAAG,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;MAClBA,GAAG,GAAGA,GAAG,CAACvB,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IACxB;IACA,IAAI,KAAK,CAAC,KAAKL,GAAG,CAAC6B,GAAG,CAAC,EAAE;MACvB7B,GAAG,CAAC6B,GAAG,CAAC,GAAGT,SAAS,CAACQ,GAAG,EAAGD,GAAG,CAACb,MAAM,IAAIA,MAAO,CAAC;IACnD;EACF,CAAC,CAAC;EACF,OAAOd,GAAG;AACZ,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,MAAMsC,YAAY,GAAIC,IAAI,IAAK;EAC7B,MAAMC,MAAM,GAAG1C,OAAO,CAACK,KAAK,CAACoC,IAAI,CAAC;EAClC,MAAME,KAAK,GAAI,IAAIC,GAAG,CAAC,CAAC;EACxB,OAAOC,IAAI,CAACC,SAAS,CAACJ,MAAM,EAAE,CAACX,GAAG,EAAEgB,KAAK,KAAK;IAC5C,IAAI,OAAOA,KAAK,KAAK,QAAQ,IAAIA,KAAK,KAAK,IAAI,EAAE;MAC/C,IAAIJ,KAAK,CAACK,GAAG,CAACD,KAAK,CAAC,EAAE;QACpB,OAAO,KAAK,CAAC;MACf;MACAJ,KAAK,CAACM,GAAG,CAACF,KAAK,EAAE,IAAI,CAAC;IACxB;IACA,OAAOA,KAAK;EACd,CAAC,CAAC;AACJ,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMG,SAAS,GAAG,SAAAA,CAACnB,GAAG,EAAED,GAAG,EAAe;EAAA,IAAbD,GAAG,GAAAsB,SAAA,CAAAvC,MAAA,QAAAuC,SAAA,QAAAC,SAAA,GAAAD,SAAA,MAAG,CAAC,CAAC;EACnC,IAAIE,IAAI;EAER,IAAI,CAAChC,kBAAkB,CAACiC,IAAI,CAACvB,GAAG,CAAC,EAAE;IACjCsB,IAAI,GAAGE,MAAM,CAACxB,GAAG,CAAC;EACpB,CAAC,MAAM;IACLsB,IAAI,GAAGtB,GAAG;EACZ;EAEA,IAAIyB,cAAc,GAAG1B,GAAG;EACxB,IAAIiB,KAAK,GAAGjB,GAAG;EACf,IAAI,CAAC9B,OAAO,CAACC,WAAW,CAAC8C,KAAK,CAAC,EAAE;IAC/B,IAAI/C,OAAO,CAACM,QAAQ,CAACyC,KAAK,CAAC,IAAI/C,OAAO,CAACG,OAAO,CAAC4C,KAAK,CAAC,EAAE;MACrD,MAAMU,WAAW,GAAGjB,YAAY,CAACO,KAAK,CAAC;MACvCA,KAAK,GAAG7B,MAAM,eAAAwC,MAAA,CAAeD,WAAW,MAAG,CAAC;MAC5CD,cAAc,GAAGX,IAAI,CAACnB,KAAK,CAAC+B,WAAW,CAAC;IAC1C,CAAC,MAAM;MACLV,KAAK,GAAG7B,MAAM,CAAC6B,KAAK,CAAC;MACrB,IAAIA,KAAK,IAAI,CAAC1B,kBAAkB,CAACiC,IAAI,CAACP,KAAK,CAAC,EAAE;QAC5CA,KAAK,GAAGQ,MAAM,CAACR,KAAK,CAAC;MACvB;IACF;EACF,CAAC,MAAM;IACLA,KAAK,GAAG,EAAE;EACZ;EAEA,MAAMY,KAAK,GAAG,IAAAD,MAAA,CAAIL,IAAI,OAAAK,MAAA,CAAIX,KAAK,EAAG;EAElC,IAAI/C,OAAO,CAAC4D,QAAQ,CAAC/B,GAAG,CAACgC,MAAM,CAAC,EAAE;IAChCF,KAAK,CAACG,IAAI,YAAAJ,MAAA,CAAY7B,GAAG,CAACgC,MAAM,CAAE,CAAC;EACrC;EAEA,IAAIhC,GAAG,CAACkC,MAAM,IAAI,OAAOlC,GAAG,CAACkC,MAAM,KAAK,QAAQ,EAAE;IAChD,IAAI,CAAC1C,kBAAkB,CAACiC,IAAI,CAACzB,GAAG,CAACkC,MAAM,CAAC,EAAE;MACxC,MAAM,IAAIjF,MAAM,CAAC8C,KAAK,CAAC,GAAG,EAAE,0BAA0B,CAAC;IACzD;IACA+B,KAAK,CAACG,IAAI,WAAAJ,MAAA,CAAW7B,GAAG,CAACkC,MAAM,CAAE,CAAC;EACpC;EAEA,IAAIlC,GAAG,CAACmC,IAAI,IAAI,OAAOnC,GAAG,CAACmC,IAAI,KAAK,QAAQ,EAAE;IAC5C,IAAI,CAAC3C,kBAAkB,CAACiC,IAAI,CAACzB,GAAG,CAACmC,IAAI,CAAC,EAAE;MACtC,MAAM,IAAIlF,MAAM,CAAC8C,KAAK,CAAC,GAAG,EAAE,wBAAwB,CAAC;IACvD;IACA+B,KAAK,CAACG,IAAI,SAAAJ,MAAA,CAAS7B,GAAG,CAACmC,IAAI,CAAE,CAAC;EAChC,CAAC,MAAM;IACLL,KAAK,CAACG,IAAI,CAAC,QAAQ,CAAC;EACtB;EAEAjC,GAAG,CAACoC,OAAO,GAAGpC,GAAG,CAACoC,OAAO,IAAIpC,GAAG,CAACqC,MAAM,IAAI,KAAK;EAChD,IAAIrC,GAAG,CAACoC,OAAO,KAAKE,QAAQ,EAAE;IAC5BR,KAAK,CAACG,IAAI,CAAC,uCAAuC,CAAC;EACrD,CAAC,MAAM,IAAIjC,GAAG,CAACoC,OAAO,YAAYG,IAAI,EAAE;IACtCT,KAAK,CAACG,IAAI,YAAAJ,MAAA,CAAY7B,GAAG,CAACoC,OAAO,CAACI,WAAW,CAAC,CAAC,CAAE,CAAC;EACpD,CAAC,MAAM,IAAIxC,GAAG,CAACoC,OAAO,KAAK,CAAC,EAAE;IAC5BN,KAAK,CAACG,IAAI,CAAC,WAAW,CAAC;EACzB,CAAC,MAAM,IAAI9D,OAAO,CAAC4D,QAAQ,CAAC/B,GAAG,CAACoC,OAAO,CAAC,EAAE;IACxCN,KAAK,CAACG,IAAI,YAAAJ,MAAA,CAAa,IAAIU,IAAI,CAACvC,GAAG,CAACoC,OAAO,CAAC,CAAEI,WAAW,CAAC,CAAC,CAAE,CAAC;EAChE;EAEA,IAAIxC,GAAG,CAACyC,QAAQ,EAAE;IAChBX,KAAK,CAACG,IAAI,CAAC,UAAU,CAAC;EACxB;EAEA,IAAIjC,GAAG,CAAC0C,MAAM,EAAE;IACdZ,KAAK,CAACG,IAAI,CAAC,QAAQ,CAAC;EACtB;EAEA,IAAIjC,GAAG,CAAC2C,cAAc,EAAE;IACtBb,KAAK,CAACG,IAAI,CAAC,kBAAkB,CAAC;EAChC;EAEA,IAAIjC,GAAG,CAAC4C,QAAQ,EAAE;IAChBd,KAAK,CAACG,IAAI,CAACjC,GAAG,CAAC4C,QAAQ,KAAK,IAAI,GAAG,UAAU,eAAAf,MAAA,CAAe7B,GAAG,CAAC4C,QAAQ,CAAE,CAAC;EAC7E;EAEA,OAAO;IAAEC,YAAY,EAAEf,KAAK,CAACgB,IAAI,CAAC,IAAI,CAAC;IAAEnB;EAAe,CAAC;AAC3D,CAAC;AAED,MAAMoB,kBAAkB,GAAG,qBAAqB;AAChD,MAAMC,YAAY,GAAG,iBAAiB;AACtC,MAAMC,WAAW,GAAIC,MAAM,IAAK;EAC9B,IAAI,OAAOA,MAAM,KAAK,QAAQ,EAAE;IAC9B,OAAOA,MAAM;EACf;EAEA,IAAIH,kBAAkB,CAACtB,IAAI,CAACyB,MAAM,CAAC,EAAE;IACnC,IAAI7E,GAAG,GAAG6E,MAAM,CAACC,KAAK,CAACJ,kBAAkB,CAAC,CAAC,CAAC,CAAC;IAC7C,IAAI1E,GAAG,EAAE;MACP,IAAI;QACF,OAAO2C,IAAI,CAACnB,KAAK,CAACV,MAAM,CAACd,GAAG,CAAC,CAAC;MAChC,CAAC,CAAC,OAAOuB,CAAC,EAAE;QACVwD,OAAO,CAACC,KAAK,CAAC,sDAAsD,EAAEzD,CAAC,EAAEsD,MAAM,EAAE7E,GAAG,CAAC;QACrF,OAAO6E,MAAM;MACf;IACF;IACA,OAAOA,MAAM;EACf,CAAC,MAAM,IAAIF,YAAY,CAACvB,IAAI,CAACyB,MAAM,CAAC,EAAE;IACpC,IAAI;MACF,OAAOlC,IAAI,CAACnB,KAAK,CAACqD,MAAM,CAAC;IAC3B,CAAC,CAAC,OAAOtD,CAAC,EAAE;MACV,OAAOsD,MAAM;IACf;EACF;EACA,OAAOA,MAAM;AACf,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMI,SAAS,CAAC;EACdC,WAAWA,CAACC,IAAI,EAAE;IAChB,IAAI,CAACC,gBAAgB,GAAG,EAAE;IAC1B,IAAI,CAACC,GAAG,GAAGF,IAAI,CAACE,GAAG,IAAI,KAAK;IAC5B,IAAI,CAACC,QAAQ,GAAGH,IAAI,CAACG,QAAQ,IAAI,KAAK;IACtC,IAAI,CAACC,WAAW,GAAGJ,IAAI,CAACI,WAAW,IAAI,KAAK;IAC5C,IAAI,CAACC,uBAAuB,GAAGL,IAAI,CAACK,uBAAuB,IAAI,KAAK;IACpE,IAAI,CAACC,qBAAqB,GAAGN,IAAI,CAACM,qBAAqB,IAAI,KAAK;IAEhE,IAAI,IAAI,CAACA,qBAAqB,KAAK,IAAI,EAAE;MACvC,IAAI,CAACA,qBAAqB,GAAG,iCAAiC;IAChE;IAEA,IAAI,CAACC,QAAQ,GAAG,IAAIC,MAAM,eAAAnC,MAAA,CAAiBnE,OAAO,GAAGA,OAAO,GAAG,EAAE,EAAAmE,MAAA,CAAG5D,aAAa,GAAI,GAAG,GAAGA,aAAa,GAAI,EAAE,OAAI,CAAC;IAEnH,IAAIE,OAAO,CAACM,QAAQ,CAAC+E,IAAI,CAACS,QAAQ,CAAC,EAAE;MACnC,IAAI,CAACC,OAAO,GAAGV,IAAI,CAACS,QAAQ;IAC9B,CAAC,MAAM;MACL,IAAI,CAACC,OAAO,GAAGrE,KAAK,CAAC2D,IAAI,CAACS,QAAQ,CAAC;IACrC;EACF;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE9C,GAAGA,CAACjB,GAAG,EAAEiE,IAAI,EAAE;IACb,MAAMtB,YAAY,GAAGsB,IAAI,GAAGtE,KAAK,CAACsE,IAAI,CAAC,GAAG,IAAI,CAACD,OAAO;IACtD,IAAI,CAAChE,GAAG,IAAI,CAAC2C,YAAY,EAAE;MACzB,OAAO,KAAK,CAAC;IACf;IAEA,IAAIA,YAAY,CAACuB,cAAc,CAAClE,GAAG,CAAC,EAAE;MACpC,OAAO+C,WAAW,CAACJ,YAAY,CAAC3C,GAAG,CAAC,CAAC;IACvC;IAEA,OAAO,KAAK,CAAC;EACf;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEkB,GAAGA,CAAClB,GAAG,EAAEgB,KAAK,EAAa;IAAA,IAAXsC,IAAI,GAAAlC,SAAA,CAAAvC,MAAA,QAAAuC,SAAA,QAAAC,SAAA,GAAAD,SAAA,MAAG,CAAC,CAAC;IACvB,IAAIpB,GAAG,IAAI,CAAC/B,OAAO,CAACC,WAAW,CAAC8C,KAAK,CAAC,EAAE;MACtC,IAAI/C,OAAO,CAAC4D,QAAQ,CAAC,IAAI,CAAC2B,GAAG,CAAC,IAAIF,IAAI,CAACpB,OAAO,KAAKb,SAAS,EAAE;QAC5DiC,IAAI,CAACpB,OAAO,GAAG,IAAIG,IAAI,CAAC,CAAC,IAAIA,IAAI,CAAC,CAAC,GAAG,IAAI,CAACmB,GAAG,CAAC;MACjD;MACA,MAAM;QAAEb,YAAY;QAAElB;MAAe,CAAC,GAAGN,SAAS,CAACnB,GAAG,EAAEgB,KAAK,EAAEsC,IAAI,CAAC;MAEpE,IAAI,CAACU,OAAO,CAAChE,GAAG,CAAC,GAAGyB,cAAc;MAClC,IAAI1E,MAAM,CAACoH,QAAQ,EAAE;QACnBC,QAAQ,CAACC,MAAM,GAAG1B,YAAY;MAChC,CAAC,MAAM,IAAI,IAAI,CAACc,QAAQ,EAAE;QACxB,IAAI,CAACF,gBAAgB,CAACxB,IAAI,CAACY,YAAY,CAAC;QACxC,IAAI,CAACc,QAAQ,CAACa,SAAS,CAAC,YAAY,EAAE,IAAI,CAACf,gBAAgB,CAAC;MAC9D;MACA,OAAO,IAAI;IACb;IACA,OAAO,KAAK;EACd;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEgB,MAAMA,CAACvE,GAAG,EAA2B;IAAA,IAAzBiC,IAAI,GAAAb,SAAA,CAAAvC,MAAA,QAAAuC,SAAA,QAAAC,SAAA,GAAAD,SAAA,MAAG,GAAG;IAAA,IAAEY,MAAM,GAAAZ,SAAA,CAAAvC,MAAA,QAAAuC,SAAA,QAAAC,SAAA,GAAAD,SAAA,MAAG,EAAE;IACjC,IAAIpB,GAAG,IAAI,IAAI,CAACgE,OAAO,CAACE,cAAc,CAAClE,GAAG,CAAC,EAAE;MAC3C,MAAM;QAAE2C;MAAa,CAAC,GAAGxB,SAAS,CAACnB,GAAG,EAAE,EAAE,EAAE;QAC1CgC,MAAM;QACNC,IAAI;QACJC,OAAO,EAAE,IAAIG,IAAI,CAAC,CAAC;MACrB,CAAC,CAAC;MAEF,OAAO,IAAI,CAAC2B,OAAO,CAAChE,GAAG,CAAC;MACxB,IAAIjD,MAAM,CAACoH,QAAQ,EAAE;QACnBC,QAAQ,CAACC,MAAM,GAAG1B,YAAY;MAChC,CAAC,MAAM,IAAI,IAAI,CAACc,QAAQ,EAAE;QACxB,IAAI,CAACA,QAAQ,CAACa,SAAS,CAAC,YAAY,EAAE3B,YAAY,CAAC;MACrD;MACA,OAAO,IAAI;IACb,CAAC,MAAM,IAAI,CAAC3C,GAAG,IAAI,IAAI,CAACwE,IAAI,CAAC,CAAC,CAAC3F,MAAM,GAAG,CAAC,IAAI,IAAI,CAAC2F,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,EAAE;MAClE,MAAMA,IAAI,GAAG/F,MAAM,CAAC+F,IAAI,CAAC,IAAI,CAACR,OAAO,CAAC;MACtC,KAAK,IAAIpF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG4F,IAAI,CAAC3F,MAAM,EAAED,CAAC,EAAE,EAAE;QACpC,IAAI,CAAC2F,MAAM,CAACC,IAAI,CAAC5F,CAAC,CAAC,CAAC;MACtB;MACA,OAAO,IAAI;IACb;IACA,OAAO,KAAK;EACd;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE6F,GAAGA,CAACzE,GAAG,EAAEiE,IAAI,EAAE;IACb,MAAMtB,YAAY,GAAGsB,IAAI,GAAGtE,KAAK,CAACsE,IAAI,CAAC,GAAG,IAAI,CAACD,OAAO;IACtD,IAAI,CAAChE,GAAG,IAAI,CAAC2C,YAAY,EAAE;MACzB,OAAO,KAAK;IACd;IAEA,OAAOA,YAAY,CAACuB,cAAc,CAAClE,GAAG,CAAC;EACzC;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;EACEwE,IAAIA,CAAA,EAAG;IACL,IAAI,IAAI,CAACR,OAAO,EAAE;MAChB,OAAOvF,MAAM,CAAC+F,IAAI,CAAC,IAAI,CAACR,OAAO,CAAC;IAClC;IACA,OAAO,EAAE;EACX;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;EACEU,IAAIA,CAAA,EAAY;IAAA,IAAXC,EAAE,GAAAvD,SAAA,CAAAvC,MAAA,QAAAuC,SAAA,QAAAC,SAAA,GAAAD,SAAA,MAAG9D,IAAI;IACZ,IAAIP,MAAM,CAACK,QAAQ,EAAE;MACnBuH,EAAE,CAAC,IAAI5H,MAAM,CAAC8C,KAAK,CAAC,GAAG,EAAE,2DAA2D,CAAC,CAAC;IACxF;IAEA,IAAI,IAAI,CAAC6D,WAAW,EAAE;MACpB,IAAIzB,IAAI,MAAAN,MAAA,CAAM/D,MAAM,CAACC,yBAAyB,CAAC+G,oBAAoB,IAAIhH,MAAM,CAACC,yBAAyB,CAACC,SAAS,CAAC8G,oBAAoB,IAAI,EAAE,sBAAmB;MAC/J,IAAIC,KAAK,GAAG,EAAE;MAEd,IAAI9H,MAAM,CAAC+H,SAAS,IAAI,IAAI,CAACnB,uBAAuB,EAAE;QACpD,MAAMoB,WAAW,GAAG,IAAI,CAACP,IAAI,CAAC,CAAC;QAC/B,MAAMQ,YAAY,GAAG,EAAE;QACvB,KAAK,IAAIpG,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGmG,WAAW,CAAClG,MAAM,EAAED,CAAC,EAAE,EAAE;UAC3C,MAAM;YAAE6C;UAAe,CAAC,GAAGN,SAAS,CAAC4D,WAAW,CAACnG,CAAC,CAAC,EAAE,IAAI,CAACqC,GAAG,CAAC8D,WAAW,CAACnG,CAAC,CAAC,CAAC,CAAC;UAC9E,MAAMwB,IAAI,MAAAuB,MAAA,CAAMoD,WAAW,CAACnG,CAAC,CAAC,OAAA+C,MAAA,CAAIF,cAAc,CAAE;UAClD,IAAI,CAACuD,YAAY,CAACC,QAAQ,CAAC7E,IAAI,CAAC,EAAE;YAChC4E,YAAY,CAACjD,IAAI,CAAC3B,IAAI,CAAC;UACzB;QACF;QAEA,IAAI4E,YAAY,CAACnG,MAAM,EAAE;UACvBoD,IAAI,GAAGlF,MAAM,CAACmI,WAAW,CAAC,kBAAkB,CAAC;UAC7CL,KAAK,qBAAAlD,MAAA,CAAqBvC,kBAAkB,CAAC4F,YAAY,CAACpC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAE;QACzE;MACF;MAEA1F,KAAK,IAAAyE,MAAA,CAAIM,IAAI,EAAAN,MAAA,CAAGkD,KAAK,GAAI;QACvBM,WAAW,EAAE,SAAS;QACtBC,IAAI,EAAE;MACR,CAAC,CAAC,CAACC,IAAI,CAAE5B,QAAQ,IAAK;QACpBkB,EAAE,CAAC,KAAK,CAAC,EAAElB,QAAQ,CAAC;MACtB,CAAC,CAAC,CAAC6B,KAAK,CAACX,EAAE,CAAC;IACd,CAAC,MAAM;MACLA,EAAE,CAAC,IAAI5H,MAAM,CAAC8C,KAAK,CAAC,GAAG,EAAE,4DAA4D,CAAC,CAAC;IACzF;IACA,OAAO,KAAK,CAAC;EACf;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM0F,mBAAmB,GAAGA,CAACC,OAAO,EAAE/B,QAAQ,EAAEH,IAAI,KAAK;EACvD,IAAIS,QAAQ,GAAG,CAAC,CAAC;EACjB,IAAIT,IAAI,CAACI,WAAW,EAAE;IACpB,IAAI8B,OAAO,CAACC,OAAO,IAAID,OAAO,CAACC,OAAO,CAACpB,MAAM,EAAE;MAC7CN,QAAQ,GAAGpE,KAAK,CAAC6F,OAAO,CAACC,OAAO,CAACpB,MAAM,CAAC;IAC1C;IAEA,OAAO,IAAIjB,SAAS,CAAC;MACnBW,QAAQ;MACRP,GAAG,EAAEF,IAAI,CAACE,GAAG;MACbE,WAAW,EAAEJ,IAAI,CAACI,WAAW;MAC7BD,QAAQ;MACRE,uBAAuB,EAAEL,IAAI,CAACK;IAChC,CAAC,CAAC;EACJ;EAEA,MAAM,IAAI5G,MAAM,CAAC8C,KAAK,CAAC,GAAG,EAAE,oDAAoD,CAAC;AACnF,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM/C,OAAO,SAASsG,SAAS,CAAC;EAC9BC,WAAWA,CAAA,EAAY;IAAA,IAAXC,IAAI,GAAAlC,SAAA,CAAAvC,MAAA,QAAAuC,SAAA,QAAAC,SAAA,GAAAD,SAAA,MAAG,CAAC,CAAC;IACnBkC,IAAI,CAACE,GAAG,GAAGvF,OAAO,CAAC4D,QAAQ,CAACyB,IAAI,CAACE,GAAG,CAAC,GAAGF,IAAI,CAACE,GAAG,GAAG,KAAK;IACxDF,IAAI,CAACI,WAAW,GAAIJ,IAAI,CAACI,WAAW,KAAK,KAAK,GAAI,IAAI,GAAG,KAAK;IAC9DJ,IAAI,CAACK,uBAAuB,GAAIL,IAAI,CAACK,uBAAuB,KAAK,IAAI,GAAI,KAAK,GAAG,IAAI;IAErF,IAAI5G,MAAM,CAACoH,QAAQ,EAAE;MACnBb,IAAI,CAACS,QAAQ,GAAGK,QAAQ,CAACC,MAAM;MAC/B,KAAK,CAACf,IAAI,CAAC;IACb,CAAC,MAAM;MACLA,IAAI,CAACS,QAAQ,GAAG,CAAC,CAAC;MAClB,KAAK,CAACT,IAAI,CAAC;MACXA,IAAI,CAACoC,IAAI,GAAIpC,IAAI,CAACoC,IAAI,KAAK,KAAK,GAAI,IAAI,GAAG,KAAK;MAChD,IAAI,CAACpC,IAAI,GAAGA,IAAI;MAChB,IAAI,CAACqC,OAAO,GAAG1H,OAAO,CAAC2H,UAAU,CAACtC,IAAI,CAACqC,OAAO,CAAC,GAAGrC,IAAI,CAACqC,OAAO,GAAG,KAAK;MACtE,IAAI,CAACE,SAAS,GAAG5H,OAAO,CAAC2H,UAAU,CAACtC,IAAI,CAACuC,SAAS,CAAC,GAAGvC,IAAI,CAACuC,SAAS,GAAG,KAAK;MAE5E,IAAIvC,IAAI,CAACI,WAAW,IAAI,CAAC5G,OAAO,CAACgJ,gBAAgB,EAAE;QACjDhJ,OAAO,CAACgJ,gBAAgB,GAAG,IAAI;QAC/B,IAAIxC,IAAI,CAACoC,IAAI,EAAE;UACbvI,MAAM,CAAC4I,eAAe,CAACC,GAAG,CAAC,CAACC,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;YAC7C,IAAI5I,KAAK,CAACgE,IAAI,CAAC0E,GAAG,CAACG,UAAU,CAACnE,IAAI,CAAC,EAAE;cACnC,MAAMoE,oBAAoB,GAAG,CAAC,CAACJ,GAAG,CAACR,OAAO,CAACa,MAAM,IAC5C,IAAI,CAAC1C,qBAAqB,IAC1B,IAAI,CAACA,qBAAqB,CAACrC,IAAI,CAAC0E,GAAG,CAACR,OAAO,CAACa,MAAM,CAAC;cACxD,MAAMC,aAAa,GAAGF,oBAAoB,IACpC,CAAC,CAACJ,GAAG,CAACR,OAAO,CAACa,MAAM,IAAI,IAAI,CAACzC,QAAQ,CAACtC,IAAI,CAAC0E,GAAG,CAACR,OAAO,CAACa,MAAM,CAAE;cAErE,IAAIC,aAAa,EAAE;gBACjBL,GAAG,CAAC5B,SAAS,CAAC,kCAAkC,EAAE,MAAM,CAAC;gBACzD4B,GAAG,CAAC5B,SAAS,CAAC,6BAA6B,EAAE2B,GAAG,CAACR,OAAO,CAACa,MAAM,CAAC;cAClE;cAEA,MAAMtB,YAAY,GAAG,EAAE;cACvB,IAAIwB,aAAa,GAAG,CAAC,CAAC;cACtB,IAAIH,oBAAoB,IAAI/C,IAAI,CAACK,uBAAuB,IAAIsC,GAAG,CAACpB,KAAK,CAAC4B,aAAa,EAAE;gBACnFD,aAAa,GAAG7G,KAAK,CAACT,kBAAkB,CAAC+G,GAAG,CAACpB,KAAK,CAAC4B,aAAa,CAAC,CAAC;cACpE,CAAC,MAAM,IAAIR,GAAG,CAACR,OAAO,CAACpB,MAAM,EAAE;gBAC7BmC,aAAa,GAAG7G,KAAK,CAACsG,GAAG,CAACR,OAAO,CAACpB,MAAM,CAAC;cAC3C;cAEA,MAAMU,WAAW,GAAGtG,MAAM,CAAC+F,IAAI,CAACgC,aAAa,CAAC;cAC9C,IAAIzB,WAAW,CAAClG,MAAM,EAAE;gBACtB,KAAK,IAAID,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGmG,WAAW,CAAClG,MAAM,EAAED,CAAC,EAAE,EAAE;kBAC3C,MAAM;oBAAE+D;kBAAa,CAAC,GAAGxB,SAAS,CAAC4D,WAAW,CAACnG,CAAC,CAAC,EAAE4H,aAAa,CAACzB,WAAW,CAACnG,CAAC,CAAC,CAAC,CAAC;kBACjF,IAAI,CAACoG,YAAY,CAACC,QAAQ,CAACtC,YAAY,CAAC,EAAE;oBACxCqC,YAAY,CAACjD,IAAI,CAACY,YAAY,CAAC;kBACjC;gBACF;gBAEA,IAAIqC,YAAY,CAACnG,MAAM,EAAE;kBACvBqH,GAAG,CAAC5B,SAAS,CAAC,YAAY,EAAEU,YAAY,CAAC;gBAC3C;cACF;cAEA/G,OAAO,CAAC2H,UAAU,CAAC,IAAI,CAACC,SAAS,CAAC,IAAI,IAAI,CAACA,SAAS,CAACN,mBAAmB,CAACU,GAAG,EAAEC,GAAG,EAAE5C,IAAI,CAAC,CAAC;cAEzF4C,GAAG,CAACQ,SAAS,CAAC,GAAG,CAAC;cAClBR,GAAG,CAACS,GAAG,CAAC,EAAE,CAAC;YACb,CAAC,MAAM;cACLV,GAAG,CAACnJ,OAAO,GAAGyI,mBAAmB,CAACU,GAAG,EAAEC,GAAG,EAAE5C,IAAI,CAAC;cACjDrF,OAAO,CAAC2H,UAAU,CAAC,IAAI,CAACD,OAAO,CAAC,IAAI,IAAI,CAACA,OAAO,CAACM,GAAG,CAACnJ,OAAO,CAAC;cAC7DqJ,IAAI,CAAC,CAAC;YACR;UACF,CAAC,CAAC;QACJ;MACF;IACF;EACF;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;EACES,UAAUA,CAAA,EAAG;IACX,IAAI,CAAC7J,MAAM,CAACK,QAAQ,EAAE;MACpB,MAAM,IAAIL,MAAM,CAAC8C,KAAK,CAAC,GAAG,EAAE,2EAA2E,CAAC;IAC1G;IAEA,OAAO,CAACoG,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;MACzBlI,OAAO,CAAC2H,UAAU,CAAC,IAAI,CAACD,OAAO,CAAC,IAAI,IAAI,CAACA,OAAO,CAACJ,mBAAmB,CAACU,GAAG,EAAEC,GAAG,EAAE,IAAI,CAAC5C,IAAI,CAAC,CAAC;MAC1F6C,IAAI,CAAC,CAAC;IACR,CAAC;EACH;AACF;AAEA,IAAIpJ,MAAM,CAACK,QAAQ,EAAE;EACnBN,OAAO,CAACgJ,gBAAgB,GAAG,KAAK;AAClC;;AAEA,8B","file":"/packages/ostrio_cookies.js","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nlet fetch;\nlet WebApp;\n\nif (Meteor.isServer) {\n  WebApp = require('meteor/webapp').WebApp;\n} else {\n  fetch = require('meteor/fetch').fetch;\n}\n\nconst NoOp  = () => {};\nconst urlRE = /\\/___cookie___\\/set/;\nconst rootUrl = Meteor.isServer ? process.env.ROOT_URL : (window.__meteor_runtime_config__.ROOT_URL || window.__meteor_runtime_config__.meteorEnv.ROOT_URL || false);\nconst mobileRootUrl = Meteor.isServer ? process.env.MOBILE_ROOT_URL : (window.__meteor_runtime_config__.MOBILE_ROOT_URL || window.__meteor_runtime_config__.meteorEnv.MOBILE_ROOT_URL || false);\n\nconst helpers = {\n  isUndefined(obj) {\n    return obj === void 0;\n  },\n  isArray(obj) {\n    return Array.isArray(obj);\n  },\n  clone(obj) {\n    if (!this.isObject(obj)) return obj;\n    return this.isArray(obj) ? obj.slice() : Object.assign({}, obj);\n  }\n};\nconst _helpers = ['Number', 'Object', 'Function'];\nfor (let i = 0; i < _helpers.length; i++) {\n  helpers['is' + _helpers[i]] = function (obj) {\n    return Object.prototype.toString.call(obj) === '[object ' + _helpers[i] + ']';\n  };\n}\n\n/*\n * @url https://github.com/jshttp/cookie/blob/master/index.js\n * @name cookie\n * @author jshttp\n * @license\n * (The MIT License)\n *\n * Copyright (c) 2012-2014 Roman Shtylman <shtylman@gmail.com>\n * Copyright (c) 2015 Douglas Christopher Wilson <doug@somethingdoug.com>\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * 'Software'), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\nconst decode = decodeURIComponent;\nconst encode = encodeURIComponent;\nconst pairSplitRegExp = /; */;\n\n/*\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\nconst fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n\n/*\n * @function\n * @name tryDecode\n * @param {String} str\n * @param {Function} d\n * @summary Try decoding a string using a decoding function.\n * @private\n */\nconst tryDecode = (str, d) => {\n  try {\n    return d(str);\n  } catch (e) {\n    return str;\n  }\n};\n\n/*\n * @function\n * @name parse\n * @param {String} str\n * @param {Object} [options]\n * @return {Object}\n * @summary\n * Parse a cookie header.\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n * @private\n */\nconst parse = (str, options) => {\n  if (typeof str !== 'string') {\n    throw new Meteor.Error(404, 'argument str must be a string');\n  }\n  const obj = {};\n  const opt = options || {};\n  let val;\n  let key;\n  let eqIndx;\n\n  str.split(pairSplitRegExp).forEach((pair) => {\n    eqIndx = pair.indexOf('=');\n    if (eqIndx < 0) {\n      return;\n    }\n    key = pair.substr(0, eqIndx).trim();\n    key = tryDecode(unescape(key), (opt.decode || decode));\n    val = pair.substr(++eqIndx, pair.length).trim();\n    if (val[0] === '\"') {\n      val = val.slice(1, -1);\n    }\n    if (void 0 === obj[key]) {\n      obj[key] = tryDecode(val, (opt.decode || decode));\n    }\n  });\n  return obj;\n};\n\n/*\n * @function\n * @name antiCircular\n * @param data {Object} - Circular or any other object which needs to be non-circular\n * @private\n */\nconst antiCircular = (_obj) => {\n  const object = helpers.clone(_obj);\n  const cache  = new Map();\n  return JSON.stringify(object, (key, value) => {\n    if (typeof value === 'object' && value !== null) {\n      if (cache.get(value)) {\n        return void 0;\n      }\n      cache.set(value, true);\n    }\n    return value;\n  });\n};\n\n/*\n * @function\n * @name serialize\n * @param {String} name\n * @param {String} val\n * @param {Object} [options]\n * @return { cookieString: String, sanitizedValue: Mixed }\n * @summary\n * Serialize data into a cookie header.\n * Serialize the a name value pair into a cookie string suitable for\n * http headers. An optional options object specified cookie parameters.\n * serialize('foo', 'bar', { httpOnly: true }) => \"foo=bar; httpOnly\"\n * @private\n */\nconst serialize = (key, val, opt = {}) => {\n  let name;\n\n  if (!fieldContentRegExp.test(key)) {\n    name = escape(key);\n  } else {\n    name = key;\n  }\n\n  let sanitizedValue = val;\n  let value = val;\n  if (!helpers.isUndefined(value)) {\n    if (helpers.isObject(value) || helpers.isArray(value)) {\n      const stringified = antiCircular(value);\n      value = encode(`JSON.parse(${stringified})`);\n      sanitizedValue = JSON.parse(stringified);\n    } else {\n      value = encode(value);\n      if (value && !fieldContentRegExp.test(value)) {\n        value = escape(value);\n      }\n    }\n  } else {\n    value = '';\n  }\n\n  const pairs = [`${name}=${value}`];\n\n  if (helpers.isNumber(opt.maxAge)) {\n    pairs.push(`Max-Age=${opt.maxAge}`);\n  }\n\n  if (opt.domain && typeof opt.domain === 'string') {\n    if (!fieldContentRegExp.test(opt.domain)) {\n      throw new Meteor.Error(404, 'option domain is invalid');\n    }\n    pairs.push(`Domain=${opt.domain}`);\n  }\n\n  if (opt.path && typeof opt.path === 'string') {\n    if (!fieldContentRegExp.test(opt.path)) {\n      throw new Meteor.Error(404, 'option path is invalid');\n    }\n    pairs.push(`Path=${opt.path}`);\n  } else {\n    pairs.push('Path=/');\n  }\n\n  opt.expires = opt.expires || opt.expire || false;\n  if (opt.expires === Infinity) {\n    pairs.push('Expires=Fri, 31 Dec 9999 23:59:59 GMT');\n  } else if (opt.expires instanceof Date) {\n    pairs.push(`Expires=${opt.expires.toUTCString()}`);\n  } else if (opt.expires === 0) {\n    pairs.push('Expires=0');\n  } else if (helpers.isNumber(opt.expires)) {\n    pairs.push(`Expires=${(new Date(opt.expires)).toUTCString()}`);\n  }\n\n  if (opt.httpOnly) {\n    pairs.push('HttpOnly');\n  }\n\n  if (opt.secure) {\n    pairs.push('Secure');\n  }\n\n  if (opt.firstPartyOnly) {\n    pairs.push('First-Party-Only');\n  }\n\n  if (opt.sameSite) {\n    pairs.push(opt.sameSite === true ? 'SameSite' : `SameSite=${opt.sameSite}`);\n  }\n\n  return { cookieString: pairs.join('; '), sanitizedValue };\n};\n\nconst isStringifiedRegEx = /JSON\\.parse\\((.*)\\)/;\nconst isTypedRegEx = /false|true|null/;\nconst deserialize = (string) => {\n  if (typeof string !== 'string') {\n    return string;\n  }\n\n  if (isStringifiedRegEx.test(string)) {\n    let obj = string.match(isStringifiedRegEx)[1];\n    if (obj) {\n      try {\n        return JSON.parse(decode(obj));\n      } catch (e) {\n        console.error('[ostrio:cookies] [.get()] [deserialize()] Exception:', e, string, obj);\n        return string;\n      }\n    }\n    return string;\n  } else if (isTypedRegEx.test(string)) {\n    try {\n      return JSON.parse(string);\n    } catch (e) {\n      return string;\n    }\n  }\n  return string;\n};\n\n/*\n * @locus Anywhere\n * @class __cookies\n * @param opts {Object} - Options (configuration) object\n * @param opts._cookies {Object|String} - Current cookies as String or Object\n * @param opts.TTL {Number|Boolean} - Default cookies expiration time (max-age) in milliseconds, by default - session (false)\n * @param opts.runOnServer {Boolean} - Expose Cookies class to Server\n * @param opts.response {http.ServerResponse|Object} - This object is created internally by a HTTP server\n * @param opts.allowQueryStringCookies {Boolean} - Allow passing Cookies in a query string (in URL). Primary should be used only in Cordova environment\n * @param opts.allowedCordovaOrigins {Regex|Boolean} - [Server] Allow setting Cookies from that specific origin which in Meteor/Cordova is localhost:12XXX (^http://localhost:12[0-9]{3}$)\n * @summary Internal Class\n */\nclass __cookies {\n  constructor(opts) {\n    this.__pendingCookies = [];\n    this.TTL = opts.TTL || false;\n    this.response = opts.response || false;\n    this.runOnServer = opts.runOnServer || false;\n    this.allowQueryStringCookies = opts.allowQueryStringCookies || false;\n    this.allowedCordovaOrigins = opts.allowedCordovaOrigins || false;\n\n    if (this.allowedCordovaOrigins === true) {\n      this.allowedCordovaOrigins = /^http:\\/\\/localhost:12[0-9]{3}$/;\n    }\n\n    this.originRE = new RegExp(`^https?:\\/\\/(${rootUrl ? rootUrl : ''}${mobileRootUrl ? ('|' + mobileRootUrl) : ''})$`);\n\n    if (helpers.isObject(opts._cookies)) {\n      this.cookies = opts._cookies;\n    } else {\n      this.cookies = parse(opts._cookies);\n    }\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name get\n   * @param {String} key  - The name of the cookie to read\n   * @param {String} _tmp - Unparsed string instead of user's cookies\n   * @summary Read a cookie. If the cookie doesn't exist a null value will be returned.\n   * @returns {String|void}\n   */\n  get(key, _tmp) {\n    const cookieString = _tmp ? parse(_tmp) : this.cookies;\n    if (!key || !cookieString) {\n      return void 0;\n    }\n\n    if (cookieString.hasOwnProperty(key)) {\n      return deserialize(cookieString[key]);\n    }\n\n    return void 0;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name set\n   * @param {String} key   - The name of the cookie to create/overwrite\n   * @param {String} value - The value of the cookie\n   * @param {Object} opts  - [Optional] Cookie options (see readme docs)\n   * @summary Create/overwrite a cookie.\n   * @returns {Boolean}\n   */\n  set(key, value, opts = {}) {\n    if (key && !helpers.isUndefined(value)) {\n      if (helpers.isNumber(this.TTL) && opts.expires === undefined) {\n        opts.expires = new Date(+new Date() + this.TTL);\n      }\n      const { cookieString, sanitizedValue } = serialize(key, value, opts);\n\n      this.cookies[key] = sanitizedValue;\n      if (Meteor.isClient) {\n        document.cookie = cookieString;\n      } else if (this.response) {\n        this.__pendingCookies.push(cookieString);\n        this.response.setHeader('Set-Cookie', this.__pendingCookies);\n      }\n      return true;\n    }\n    return false;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name remove\n   * @param {String} key    - The name of the cookie to create/overwrite\n   * @param {String} path   - [Optional] The path from where the cookie will be\n   * readable. E.g., \"/\", \"/mydir\"; if not specified, defaults to the current\n   * path of the current document location (string or null). The path must be\n   * absolute (see RFC 2965). For more information on how to use relative paths\n   * in this argument, see: https://developer.mozilla.org/en-US/docs/Web/API/document.cookie#Using_relative_URLs_in_the_path_parameter\n   * @param {String} domain - [Optional] The domain from where the cookie will\n   * be readable. E.g., \"example.com\", \".example.com\" (includes all subdomains)\n   * or \"subdomain.example.com\"; if not specified, defaults to the host portion\n   * of the current document location (string or null).\n   * @summary Remove a cookie(s).\n   * @returns {Boolean}\n   */\n  remove(key, path = '/', domain = '') {\n    if (key && this.cookies.hasOwnProperty(key)) {\n      const { cookieString } = serialize(key, '', {\n        domain,\n        path,\n        expires: new Date(0)\n      });\n\n      delete this.cookies[key];\n      if (Meteor.isClient) {\n        document.cookie = cookieString;\n      } else if (this.response) {\n        this.response.setHeader('Set-Cookie', cookieString);\n      }\n      return true;\n    } else if (!key && this.keys().length > 0 && this.keys()[0] !== '') {\n      const keys = Object.keys(this.cookies);\n      for (let i = 0; i < keys.length; i++) {\n        this.remove(keys[i]);\n      }\n      return true;\n    }\n    return false;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name has\n   * @param {String} key  - The name of the cookie to create/overwrite\n   * @param {String} _tmp - Unparsed string instead of user's cookies\n   * @summary Check whether a cookie exists in the current position.\n   * @returns {Boolean}\n   */\n  has(key, _tmp) {\n    const cookieString = _tmp ? parse(_tmp) : this.cookies;\n    if (!key || !cookieString) {\n      return false;\n    }\n\n    return cookieString.hasOwnProperty(key);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name keys\n   * @summary Returns an array of all readable cookies from this location.\n   * @returns {[String]}\n   */\n  keys() {\n    if (this.cookies) {\n      return Object.keys(this.cookies);\n    }\n    return [];\n  }\n\n  /*\n   * @locus Client\n   * @memberOf __cookies\n   * @name send\n   * @param cb {Function} - Callback\n   * @summary Send all cookies over XHR to server.\n   * @returns {void}\n   */\n  send(cb = NoOp) {\n    if (Meteor.isServer) {\n      cb(new Meteor.Error(400, 'Can\\'t run `.send()` on server, it\\'s Client only method!'));\n    }\n\n    if (this.runOnServer) {\n      let path = `${window.__meteor_runtime_config__.ROOT_URL_PATH_PREFIX || window.__meteor_runtime_config__.meteorEnv.ROOT_URL_PATH_PREFIX || ''}/___cookie___/set`;\n      let query = '';\n\n      if (Meteor.isCordova && this.allowQueryStringCookies) {\n        const cookiesKeys = this.keys();\n        const cookiesArray = [];\n        for (let i = 0; i < cookiesKeys.length; i++) {\n          const { sanitizedValue } = serialize(cookiesKeys[i], this.get(cookiesKeys[i]));\n          const pair = `${cookiesKeys[i]}=${sanitizedValue}`;\n          if (!cookiesArray.includes(pair)) {\n            cookiesArray.push(pair);\n          }\n        }\n\n        if (cookiesArray.length) {\n          path = Meteor.absoluteUrl('___cookie___/set');\n          query = `?___cookies___=${encodeURIComponent(cookiesArray.join('; '))}`;\n        }\n      }\n\n      fetch(`${path}${query}`, {\n        credentials: 'include',\n        type: 'cors'\n      }).then((response) => {\n        cb(void 0, response);\n      }).catch(cb);\n    } else {\n      cb(new Meteor.Error(400, 'Can\\'t send cookies on server when `runOnServer` is false.'));\n    }\n    return void 0;\n  }\n}\n\n/*\n * @function\n * @locus Server\n * @summary Middleware handler\n * @private\n */\nconst __middlewareHandler = (request, response, opts) => {\n  let _cookies = {};\n  if (opts.runOnServer) {\n    if (request.headers && request.headers.cookie) {\n      _cookies = parse(request.headers.cookie);\n    }\n\n    return new __cookies({\n      _cookies,\n      TTL: opts.TTL,\n      runOnServer: opts.runOnServer,\n      response,\n      allowQueryStringCookies: opts.allowQueryStringCookies\n    });\n  }\n\n  throw new Meteor.Error(400, 'Can\\'t use middleware when `runOnServer` is false.');\n};\n\n/*\n * @locus Anywhere\n * @class Cookies\n * @param opts {Object}\n * @param opts.TTL {Number} - Default cookies expiration time (max-age) in milliseconds, by default - session (false)\n * @param opts.auto {Boolean} - [Server] Auto-bind in middleware as `req.Cookies`, by default `true`\n * @param opts.handler {Function} - [Server] Middleware handler\n * @param opts.runOnServer {Boolean} - Expose Cookies class to Server\n * @param opts.allowQueryStringCookies {Boolean} - Allow passing Cookies in a query string (in URL). Primary should be used only in Cordova environment\n * @param opts.allowedCordovaOrigins {Regex|Boolean} - [Server] Allow setting Cookies from that specific origin which in Meteor/Cordova is localhost:12XXX (^http://localhost:12[0-9]{3}$)\n * @summary Main Cookie class\n */\nclass Cookies extends __cookies {\n  constructor(opts = {}) {\n    opts.TTL = helpers.isNumber(opts.TTL) ? opts.TTL : false;\n    opts.runOnServer = (opts.runOnServer !== false) ? true : false;\n    opts.allowQueryStringCookies = (opts.allowQueryStringCookies !== true) ? false : true;\n\n    if (Meteor.isClient) {\n      opts._cookies = document.cookie;\n      super(opts);\n    } else {\n      opts._cookies = {};\n      super(opts);\n      opts.auto = (opts.auto !== false) ? true : false;\n      this.opts = opts;\n      this.handler = helpers.isFunction(opts.handler) ? opts.handler : false;\n      this.onCookies = helpers.isFunction(opts.onCookies) ? opts.onCookies : false;\n\n      if (opts.runOnServer && !Cookies.isLoadedOnServer) {\n        Cookies.isLoadedOnServer = true;\n        if (opts.auto) {\n          WebApp.connectHandlers.use((req, res, next) => {\n            if (urlRE.test(req._parsedUrl.path)) {\n              const matchedCordovaOrigin = !!req.headers.origin\n                && this.allowedCordovaOrigins\n                && this.allowedCordovaOrigins.test(req.headers.origin);\n              const matchedOrigin = matchedCordovaOrigin\n                || (!!req.headers.origin && this.originRE.test(req.headers.origin));\n\n              if (matchedOrigin) {\n                res.setHeader('Access-Control-Allow-Credentials', 'true');\n                res.setHeader('Access-Control-Allow-Origin', req.headers.origin);\n              }\n\n              const cookiesArray = [];\n              let cookiesObject = {};\n              if (matchedCordovaOrigin && opts.allowQueryStringCookies && req.query.___cookies___) {\n                cookiesObject = parse(decodeURIComponent(req.query.___cookies___));\n              } else if (req.headers.cookie) {\n                cookiesObject = parse(req.headers.cookie);\n              }\n\n              const cookiesKeys = Object.keys(cookiesObject);\n              if (cookiesKeys.length) {\n                for (let i = 0; i < cookiesKeys.length; i++) {\n                  const { cookieString } = serialize(cookiesKeys[i], cookiesObject[cookiesKeys[i]]);\n                  if (!cookiesArray.includes(cookieString)) {\n                    cookiesArray.push(cookieString);\n                  }\n                }\n\n                if (cookiesArray.length) {\n                  res.setHeader('Set-Cookie', cookiesArray);\n                }\n              }\n\n              helpers.isFunction(this.onCookies) && this.onCookies(__middlewareHandler(req, res, opts));\n\n              res.writeHead(200);\n              res.end('');\n            } else {\n              req.Cookies = __middlewareHandler(req, res, opts);\n              helpers.isFunction(this.handler) && this.handler(req.Cookies);\n              next();\n            }\n          });\n        }\n      }\n    }\n  }\n\n  /*\n   * @locus Server\n   * @memberOf Cookies\n   * @name middleware\n   * @summary Get Cookies instance into callback\n   * @returns {void}\n   */\n  middleware() {\n    if (!Meteor.isServer) {\n      throw new Meteor.Error(500, '[ostrio:cookies] Can\\'t use `.middleware()` on Client, it\\'s Server only!');\n    }\n\n    return (req, res, next) => {\n      helpers.isFunction(this.handler) && this.handler(__middlewareHandler(req, res, this.opts));\n      next();\n    };\n  }\n}\n\nif (Meteor.isServer) {\n  Cookies.isLoadedOnServer = false;\n}\n\n/* Export the Cookies class */\nexport { Cookies };\n"]}