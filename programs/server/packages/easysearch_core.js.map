{"version":3,"sources":["meteor://ðŸ’»app/packages/easysearch:core/lib/core/index.js","meteor://ðŸ’»app/packages/easysearch:core/lib/core/engine.js","meteor://ðŸ’»app/packages/easysearch:core/lib/core/reactive-engine.js","meteor://ðŸ’»app/packages/easysearch:core/lib/core/cursor.js","meteor://ðŸ’»app/packages/easysearch:core/lib/core/search-collection.js","meteor://ðŸ’»app/packages/easysearch:core/lib/engines/mongo-db.js","meteor://ðŸ’»app/packages/easysearch:core/lib/engines/minimongo.js","meteor://ðŸ’»app/packages/easysearch:core/lib/engines/mongo-text-index.js","meteor://ðŸ’»app/packages/easysearch:core/lib/globals.js","meteor://ðŸ’»app/packages/easysearch:core/lib/main.js"],"names":["Mongo","module","link","v","Engine","default","Index","constructor","config","check","Object","fields","String","ignoreCollectionCheck","collection","Collection","engine","Meteor","Error","name","_name","toLowerCase","_","extend","defaultConfiguration","defaultSearchOptions","defaults","limit","skip","props","onIndexCreate","permission","countUpdateIntervalMs","search","searchDefinition","options","arguments","length","undefined","checkSearchParam","Match","Optional","Number","userId","OneOf","_getSearchOptions","index","isServer","exportDefault","isFunction","callConfigMethod","methodName","func","_len","args","Array","_key","apply","indexConfig","allowedFields","SearchCollection","ReactiveEngine","getSearchCursor","transform","doc","beforePublish","event","searchCollection","mongoCollection","_collection","transformSearchDefinition","isString","obj","each","field","indexOptions","isObject","val","indexOf","concat","isClient","find","Cursor","mongoCursor","count","isReady","publishHandle","fetch","Function","Boolean","_mongoCursor","_count","_isReady","_publishHandle","stop","emptyCursor","observe","indexConfiguration","_indexConfiguration","_engine","_setUpPublication","subscribe","_getCount","_getMongoCursor","isNumber","countDoc","findOne","JSON","stringify","clientSort","__searchDefinition","__searchOptions","__sortPosition","sort","generateId","_id","addCustomFields","data","forEach","key","collectionScope","collectionName","publish","definitionString","optionsString","publicationScope","cursor","added","intervalID","setInterval","changed","onStop","clearInterval","resultsHandle","observedDocs","updateDocWithCustomFields","sortPosition","originalId","searchOptions","addedAt","atIndex","before","map","d","includes","docIndex","changedAt","oldDoc","movedTo","fromIndex","toIndex","beforeDoc","removedAt","removed","filter","ready","MongoDBEngine","defaultMongoConfiguration","engineScope","aggregation","selector","searchObject","searchString","fieldSelector","push","selectorPerField","replace","getFindOptions","disableOplog","pollingIntervalMs","pollingThrottleMs","findOptions","MinimongoEngine","prototype","MongoTextIndexEngine","mongoConfiguration","trim","$text","$search","textIndexesConfig","weights","_ensureIndex","EasySearch","MongoDB","Minimongo","MongoTextIndex","export"],"mappings":"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","file":"/packages/easysearch_core.js","sourcesContent":["import { Mongo } from 'meteor/mongo'\nimport Engine from './engine'\n\n/**\n * An Index represents the main entry point for searching with EasySearch. It relies on\n * the given engine to have the search functionality and defines the data that should be searchable.\n *\n * @type {Index}\n */\nclass Index {\n  /**\n   * Constructor\n   *\n   * @param {Object} config Configuration\n   *\n   * @constructor\n   */\n  constructor(config) {\n    check(config, Object);\n    check(config.fields, [String]);\n    if(!config.ignoreCollectionCheck) check(config.collection, Mongo.Collection);\n\n    if (!(config.engine instanceof Engine)) {\n      throw new Meteor.Error('invalid-engine', 'engine needs to be instanceof Engine');\n    }\n\n    if (!config.name)\n      config.name = (config.collection._name || '').toLowerCase();\n\n    this.config = _.extend(Index.defaultConfiguration, config);\n    this.defaultSearchOptions = _.defaults(\n      {},\n      this.config.defaultSearchOptions,\n      { limit: 10, skip: 0, props: {} },\n    );\n\n    // Engine specific code on index creation\n    config.engine.onIndexCreate(this.config);\n  }\n\n  /**\n   * Default configuration for an index.\n   *\n   * @returns {Object}\n   */\n  static get defaultConfiguration() {\n    return {\n      permission: () => true,\n      defaultSearchOptions: {},\n      countUpdateIntervalMs: 2000,\n    };\n  }\n\n  /**\n   * Search the index.\n   *\n   * @param {Object|String} searchDefinition Search definition\n   * @param {Object}        options          Options\n   *\n   * @returns {Cursor}\n   */\n  search(searchDefinition, options = {}) {\n    this.config.engine.checkSearchParam(searchDefinition, this.config);\n\n    check(options, {\n      limit: Match.Optional(Number),\n      skip: Match.Optional(Number),\n      props: Match.Optional(Object),\n      userId: Match.Optional(Match.OneOf(String, null)),\n    });\n\n    options = {\n      search: this._getSearchOptions(options),\n      index: this.config,\n    };\n\n    if (!this.config.permission(options.search)) {\n      throw new Meteor.Error('not-allowed', \"Not allowed to search this index!\");\n    }\n\n    return this.config.engine.search(searchDefinition, options);\n  }\n\n  /**\n   * Returns the search options based on the given options.\n   *\n   * @param {Object} options Options to use\n   *\n   * @returns {Object}\n   */\n  _getSearchOptions(options) {\n    if (!Meteor.isServer) {\n      delete options.userId;\n    }\n\n    if (typeof options.userId === \"undefined\" && Meteor.userId) {\n      options.userId = Meteor.userId();\n    }\n\n    return _.defaults(options, this.defaultSearchOptions);\n  }\n}\n\nexport default Index;\n","/**\n * An Engine is the technology used for searching with EasySearch, with\n * customizable configuration to how it interacts with the data from the Index.\n *\n * @type {Engine}\n */\nclass Engine {\n  /**\n   * Constructor\n   *\n   * @param {Object} config configuration\n   *\n   * @constructor\n   */\n  constructor(config = {}) {\n    if (this.constructor === Engine) {\n      throw new Error('Cannot initialize instance of Engine');\n    }\n\n    if (!_.isFunction(this.search)) {\n      throw new Error('Engine needs to implement search method');\n    }\n\n    this.config = _.defaults({}, config, this.defaultConfiguration());\n  }\n\n  /**\n   * Return default configuration.\n   *\n   * @returns {Object}\n   */\n  defaultConfiguration() {\n    return {};\n  }\n\n  /**\n   * Call a configuration method with the engine scope.\n   *\n   * @param {String} methodName Method name\n   * @param {Object} args       Arguments for the method\n   *\n   * @returns {*}\n   */\n  callConfigMethod(methodName, ...args) {\n    check(methodName, String);\n\n    let func = this.config[methodName];\n\n    if (func) {\n      return func.apply(this, args);\n    }\n  }\n\n  /**\n   * Check the given search parameter for validity\n   *\n   * @param search\n   */\n  checkSearchParam(search) {\n    check(search, String);\n  }\n\n  /**\n   *Code to run on index creation\n   *\n   * @param {Object} indexConfig Index configuraction\n   */\n  onIndexCreate(indexConfig) {\n    if (!indexConfig.allowedFields) {\n      indexConfig.allowedFields = indexConfig.fields;\n    }\n  }\n}\n\nexport default Engine;\n","import SearchCollection from './search-collection'\nimport Engine from './engine'\n\n/**\n * A ReactiveEngine handles the reactive logic, such as subscribing\n * and publishing documents into a self contained collection.\n *\n * @type {ReactiveEngine}\n */\nclass ReactiveEngine extends Engine {\n  /**\n   * Constructor.\n   *\n   * @param {Object} config Configuration\n   *\n   * @constructor\n   */\n  constructor(config) {\n    super(config);\n\n    if (this === this.constructor) {\n      throw new Error('Cannot initialize instance of ReactiveEngine');\n    }\n\n    if (!_.isFunction(this.getSearchCursor)) {\n      throw new Error('Reactive engine needs to implement getSearchCursor method');\n    }\n  }\n\n  /**\n   * Return default configuration.\n   *\n   * @returns {Object}\n   */\n  defaultConfiguration() {\n    return _.defaults({}, {\n      transform: (doc) => doc,\n      beforePublish: (event, doc) => doc\n    }, super.defaultConfiguration());\n  }\n\n  /**\n   * Code to run on index creation\n   *\n   * @param {Object} indexConfig Index configuration\n   */\n  onIndexCreate(indexConfig) {\n    super.onIndexCreate(indexConfig);\n    indexConfig.searchCollection = new SearchCollection(indexConfig, this);\n    indexConfig.mongoCollection = indexConfig.searchCollection._collection;\n  }\n\n  /**\n   * Transform the search definition.\n   *\n   * @param {String|Object} searchDefinition Search definition\n   * @param {Object}        options          Search and index options\n   *\n   * @returns {Object}\n   */\n  transformSearchDefinition(searchDefinition, options) {\n    if (_.isString(searchDefinition)) {\n      let obj = {};\n\n      _.each(options.index.fields, function (field) {\n        obj[field] = searchDefinition;\n      });\n\n      searchDefinition = obj;\n    }\n\n    return searchDefinition;\n  }\n\n  /**\n   * Check the given search parameter for validity\n   *\n   * @param search\n   * @param indexOptions\n   */\n  checkSearchParam(search, indexOptions) {\n    check(search, Match.OneOf(String, Object));\n\n    if (_.isObject(search)) {\n      _.each(search, function (val, field) {\n        check(val, String);\n\n        if (-1 === _.indexOf(indexOptions.allowedFields, field)) {\n          throw new Meteor.Error(`Not allowed to search over field \"${field}\"`);\n        }\n      });\n    }\n  }\n\n  /**\n   * Reactively search on the collection.\n   *\n   * @param {Object} searchDefinition Search definition\n   * @param {Object} options          Options\n   *\n   * @returns {Cursor}\n   */\n  search(searchDefinition, options) {\n    if (Meteor.isClient) {\n      return options.index.searchCollection.find(searchDefinition, options.search);\n    } else {\n      return this.getSearchCursor(\n        this.transformSearchDefinition(searchDefinition, options),\n        options\n      );\n    }\n  }\n}\n\nexport default ReactiveEngine;\n","/**\n * A Cursor represents a pointer to the search results. Since it's specific\n * to EasySearch it can also be used to check for valid return values.\n *\n * @type {Cursor}\n */\nclass Cursor {\n  /**\n   * Constructor\n   *\n   * @param {Mongo.Cursor} mongoCursor   Referenced mongo cursor\n   * @param {Number}       count         Count of all documents found\n   * @param {Boolean}      isReady       Cursor is ready\n   * @param {Object}       publishHandle Publish handle to stop if on client\n   *\n   * @constructor\n   *\n   */\n  constructor(mongoCursor, count, isReady = true, publishHandle = null) {\n    check(mongoCursor.fetch, Function);\n    check(count, Number);\n    check(isReady, Match.Optional(Boolean));\n    check(publishHandle, Match.OneOf(null, Object));\n\n    this._mongoCursor = mongoCursor;\n    this._count = count;\n    this._isReady = isReady;\n    this._publishHandle = publishHandle;\n  }\n\n  /**\n   * Fetch the search results.\n   *\n   * @returns {[Object]}\n   */\n  fetch() {\n    return this._mongoCursor.fetch();\n  }\n\n /**\n  * Stop the subscription handle associated with the cursor.\n  */\n  stop() {\n    if (this._publishHandle) {\n      return this._publishHandle.stop();\n    }\n  }\n\n  /**\n   * Return count of all documents found\n   *\n   * @returns {Number}\n   */\n  count() {\n    return this._count;\n  }\n\n  /**\n   * Return if the cursor is ready.\n   *\n   * @returns {Boolean}\n   */\n  isReady() {\n    return this._isReady;\n  }\n\n  /**\n   * Return the raw mongo cursor.\n   *\n   * @returns {Mongo.Cursor}\n   */\n  get mongoCursor() {\n    return this._mongoCursor;\n  }\n\n  /**\n   * Return a fake empty cursor, without data.\n   *\n   * @returns {Object}\n   */\n  static get emptyCursor() {\n    return { fetch: () => [], observe: () => { return { stop: () => null }; }, stop: () => {} };\n  }\n}\n\nexport default Cursor;\n","import { Mongo } from 'meteor/mongo'\nimport Cursor from './cursor'\nimport ReactiveEngine from './reactive-engine'\n\n/**\n * A search collection represents a reactive collection on the client,\n * which is used by the ReactiveEngine for searching.\n *\n * @type {SearchCollection}\n */\nclass SearchCollection {\n  /**\n   * Constructor\n   *\n   * @param {Object}         indexConfiguration Index configuration\n   * @param {ReactiveEngine} engine             Reactive Engine\n   *\n   * @constructor\n   */\n  constructor(indexConfiguration, engine) {\n    check(indexConfiguration, Object);\n    check(indexConfiguration.name, Match.OneOf(String, null));\n\n    if (!(engine instanceof ReactiveEngine)) {\n      throw new Meteor.Error('invalid-engine', 'engine needs to be instanceof ReactiveEngine');\n    }\n\n    this._indexConfiguration = indexConfiguration;\n    this._name = `${indexConfiguration.name}/easySearch`;\n    this._engine = engine;\n\n    if (Meteor.isClient) {\n      this._collection = new Mongo.Collection(this._name);\n    } else if (Meteor.isServer) {\n      this._setUpPublication();\n    }\n  }\n\n  /**\n   * Get name\n   *\n   * @returns {String}\n   */\n  get name() {\n    return this._name;\n  }\n\n  /**\n   * Get engine\n   *\n   * @returns {ReactiveEngine}\n   */\n  get engine() {\n    return this._engine;\n  }\n\n  /**\n   * Find documents on the client.\n   *\n   * @param {Object} searchDefinition Search definition\n   * @param {Object} options          Options\n   *\n   * @returns {Cursor}\n   */\n  find(searchDefinition, options) {\n    if (!Meteor.isClient) {\n      throw new Error('find can only be used on client');\n    }\n\n    let publishHandle = Meteor.subscribe(this.name, searchDefinition, options);\n\n    let count = this._getCount(searchDefinition);\n    let mongoCursor = this._getMongoCursor(searchDefinition, options);\n\n    if (!_.isNumber(count)) {\n      return new Cursor(mongoCursor, 0, false);\n    }\n\n    return new Cursor(mongoCursor, count, true, publishHandle);\n  }\n\n  /**\n   * Get the count of the cursor.\n   *\n   * @params {Object} searchDefinition Search definition\n   *\n   * @returns {Cursor.count}\n   *\n   * @private\n   */\n  _getCount(searchDefinition) {\n    let countDoc = this._collection.findOne('searchCount' + JSON.stringify(searchDefinition));\n\n    if (countDoc) {\n      return countDoc.count;\n    }\n  }\n\n  /**\n   * Get the mongo cursor on the client.\n   *\n   * @param {Object} searchDefinition Search definition\n   * @param {Object} options          Search options\n   *\n   * @returns {Cursor}\n   * @private\n   */\n  _getMongoCursor(searchDefinition, options) {\n    const clientSort = this.engine.callConfigMethod('clientSort', searchDefinition, options);\n\n    return this._collection.find(\n      { __searchDefinition: JSON.stringify(searchDefinition), __searchOptions: JSON.stringify(options.props) },\n      {\n        transform: (doc) => {\n          delete doc.__searchDefinition;\n          delete doc.__searchOptions;\n          delete doc.__sortPosition;\n\n          doc = this.engine.config.transform(doc);\n\n          return doc;\n        },\n        sort: (clientSort ? clientSort : ['__sortPosition'])\n      }\n    );\n  }\n\n  /**\n   * Return a unique document id for publication.\n   *\n   * @param {Document} doc\n   *\n   * @returns string\n   */\n  generateId(doc) {\n    return doc._id + doc.__searchDefinition + doc.__searchOptions;\n  }\n\n  /**\n   * Add custom fields to the given document\n   *\n   * @param {Document} doc\n   * @param {Object}   data\n   * @returns {*}\n   */\n  addCustomFields(doc, data) {\n    _.forEach(data, function (val, key) {\n      doc['__' + key] = val;\n    });\n\n    return doc;\n  }\n\n  /**\n   * Set up publication.\n   *\n   * @private\n   */\n  _setUpPublication() {\n    var collectionScope = this,\n      collectionName = this.name;\n\n    Meteor.publish(collectionName, function (searchDefinition, options) {\n      check(searchDefinition, Match.OneOf(String, Object));\n      check(options, Object);\n\n      let definitionString = JSON.stringify(searchDefinition),\n        optionsString = JSON.stringify(options.props);\n\n      options.userId = this.userId;\n      options.publicationScope = this;\n\n      if (!collectionScope._indexConfiguration.permission(options)) {\n        throw new Meteor.Error('not-allowed', \"You're not allowed to search this index!\");\n      }\n\n      collectionScope.engine.checkSearchParam(searchDefinition, collectionScope._indexConfiguration);\n\n      let cursor = collectionScope.engine.search(searchDefinition, {\n        search: options,\n        index: collectionScope._indexConfiguration\n      });\n\n      const count = cursor.count();\n\n      this.added(collectionName, 'searchCount' + definitionString, { count });\n\n      let intervalID;\n\n      if (collectionScope._indexConfiguration.countUpdateIntervalMs) {\n        intervalID = Meteor.setInterval(\n          () => this.changed(\n            collectionName,\n            'searchCount' + definitionString,\n            { count: cursor.mongoCursor.count && cursor.mongoCursor.count() || 0 }\n          ),\n          collectionScope._indexConfiguration.countUpdateIntervalMs\n        );\n      }\n\n      this.onStop(function () {\n        intervalID && Meteor.clearInterval(intervalID);\n        resultsHandle && resultsHandle.stop();\n      });\n\n      let observedDocs = [];\n\n      const updateDocWithCustomFields = (doc, sortPosition) => collectionScope\n        .addCustomFields(doc, {\n          originalId: doc._id,\n          sortPosition,\n          searchDefinition: definitionString,\n          searchOptions: optionsString,\n        });\n\n      let resultsHandle = cursor.mongoCursor.observe({\n        addedAt: (doc, atIndex, before) => {\n          doc = collectionScope.engine.config.beforePublish('addedAt', doc, atIndex, before);\n          doc = updateDocWithCustomFields(doc, atIndex);\n\n          this.added(collectionName, collectionScope.generateId(doc), doc);\n\n          /*\n           * Reorder all observed docs to keep valid sorting. Here we adjust the\n           * sortPosition number field to give space for the newly added doc\n           */\n          if (observedDocs.map(d => d.__sortPosition).includes(atIndex)) {\n            observedDocs = observedDocs.map((doc, docIndex) => {\n              if (doc.__sortPosition >= atIndex) {\n                doc = collectionScope.addCustomFields(doc, {\n                  sortPosition: doc.__sortPosition + 1,\n                });\n\n                // do not throw changed event on last doc as it will be removed from cursor\n                if (docIndex < observedDocs.length) {\n                  this.changed(\n                    collectionName,\n                    collectionScope.generateId(doc),\n                    doc\n                  );\n                }\n              }\n\n              return doc;\n            });\n          }\n\n          observedDocs = [...observedDocs , doc];\n        },\n        changedAt: (doc, oldDoc, atIndex) => {\n          doc = collectionScope.engine.config.beforePublish('changedAt', doc, oldDoc, atIndex);\n          doc = collectionScope.addCustomFields(doc, {\n            searchDefinition: definitionString,\n            searchOptions: optionsString,\n            sortPosition: atIndex,\n            originalId: doc._id\n          });\n\n          this.changed(collectionName, collectionScope.generateId(doc), doc);\n        },\n        movedTo: (doc, fromIndex, toIndex, before) => {\n          doc = collectionScope.engine.config.beforePublish('movedTo', doc, fromIndex, toIndex, before);\n          doc = updateDocWithCustomFields(doc, toIndex);\n\n          let beforeDoc = collectionScope._indexConfiguration.collection.findOne(before);\n\n          if (beforeDoc) {\n            beforeDoc = collectionScope.addCustomFields(beforeDoc, {\n              searchDefinition: definitionString,\n              searchOptions: optionsString,\n              sortPosition: fromIndex\n            });\n            this.changed(collectionName, collectionScope.generateId(beforeDoc), beforeDoc);\n          }\n\n          this.changed(collectionName, collectionScope.generateId(doc), doc);\n        },\n        removedAt: (doc, atIndex) => {\n          doc = collectionScope.engine.config.beforePublish('removedAt', doc, atIndex);\n          doc = collectionScope.addCustomFields(\n            doc,\n            {\n              searchDefinition: definitionString,\n              searchOptions: optionsString\n            });\n          this.removed(collectionName, collectionScope.generateId(doc));\n\n          /*\n           * Adjust sort position for all docs after the removed doc and\n           * remove the doc from the observed docs array\n           */\n          observedDocs = observedDocs.map(doc => {\n            if (doc.__sortPosition > atIndex) {\n              doc.__sortPosition -= 1;\n            }\n\n            return doc;\n          }).filter(\n            d => collectionScope.generateId(d) !== collectionScope.generateId(doc)\n          );\n        }\n      });\n\n      this.onStop(function () {\n        resultsHandle.stop();\n      });\n\n      this.ready();\n    });\n  }\n}\n\nexport default SearchCollection;\n","import Cursor from '../core/cursor';\nimport ReactiveEngine from '../core/reactive-engine';\n\n/**\n * The MongoDBEngine lets you search the index on the server side with MongoDB. Subscriptions and publications\n * are handled within the Engine.\n *\n * @type {MongoDBEngine}\n */\nclass MongoDBEngine extends ReactiveEngine {\n  /**\n   * Return default configuration.\n   *\n   * @returns {Object}\n   */\n  defaultConfiguration() {\n    return _.defaults({}, MongoDBEngine.defaultMongoConfiguration(this), super.defaultConfiguration());\n  }\n\n  /**\n   * Default mongo configuration, used in constructor and MinimongoEngine to get the configuration.\n   *\n   * @param {Object} engineScope Scope of the engine\n   *\n   * @returns {Object}\n   */\n  static defaultMongoConfiguration(engineScope) {\n    return {\n      aggregation: '$or',\n      selector(searchObject, options, aggregation) {\n        const selector = {};\n\n        selector[aggregation] = [];\n\n        _.each(searchObject, (searchString, field) => {\n          const fieldSelector = engineScope.callConfigMethod(\n            'selectorPerField', field, searchString, options\n          );\n\n          if (fieldSelector) {\n            selector[aggregation].push(fieldSelector);\n          }\n        });\n\n        return selector;\n      },\n      selectorPerField(field, searchString) {\n        const selector = {};\n\n        searchString = searchString.replace(/(\\W{1})/g, '\\\\$1');\n        selector[field] = { '$regex' : `.*${searchString}.*`, '$options' : 'i'};\n\n        return selector;\n      },\n      sort(searchObject, options) {\n        return options.index.fields;\n      }\n    };\n  }\n\n  /**\n   * Return the find options for the mongo find query.\n   *\n   * @param {String} searchDefinition Search definition\n   * @param {Object} options          Search and index options\n   */\n  getFindOptions(searchDefinition, options) {\n    return {\n      skip: options.search.skip,\n      limit: options.search.limit,\n      disableOplog: this.config.disableOplog,\n      pollingIntervalMs: this.config.pollingIntervalMs,\n      pollingThrottleMs: this.config.pollingThrottleMs,\n      sort: this.callConfigMethod('sort', searchDefinition, options),\n      fields: this.callConfigMethod('fields', searchDefinition, options)\n    };\n  }\n\n  /**\n   * Return the reactive search cursor.\n   *\n   * @param {String} searchDefinition Search definition\n   * @param {Object} options          Search and index options\n   */\n  getSearchCursor(searchDefinition, options) {\n    const selector = this.callConfigMethod(\n        'selector',\n        searchDefinition,\n        options,\n        this.config.aggregation\n      ),\n      findOptions = this.getFindOptions(searchDefinition, options),\n      collection = options.index.collection;\n\n    check(options, Object);\n    check(selector, Object);\n    check(findOptions, Object);\n\n    return new Cursor(\n      collection.find(selector, findOptions),\n      collection.find(selector).count()\n    );\n  }\n}\n\nexport default MongoDBEngine;\n","import Engine from '../core/engine';\nimport ReactiveEngine from '../core/reactive-engine';\nimport MongoDBEngine from './mongo-db';\n\n/**\n * The MinimongEngine lets you search the index on the client-side.\n *\n * @type {MinimongoEngine}\n */\nclass MinimongoEngine extends Engine {\n  /**\n   * Return default configuration.\n   *\n   * @returns {Object}\n   */\n  defaultConfiguration() {\n    return _.defaults({}, MongoDBEngine.defaultMongoConfiguration(this), super.defaultConfiguration());\n  }\n\n  /**\n   * Search the index.\n   *\n   * @param {Object} searchDefinition Search definition\n   * @param {Object} options          Object of options\n   *\n   * @returns {cursor}\n   */\n  search(searchDefinition, options) {\n    if (!Meteor.isClient) {\n      throw new Meteor.Error('only-client', 'Minimongo can only be used on the client');\n    }\n\n    searchDefinition = this.transformSearchDefinition(searchDefinition, options);\n\n    // check() calls are in getSearchCursor method\n    return MongoDBEngine.prototype.getSearchCursor.apply(this, [searchDefinition, options]);\n  }\n}\n\nMinimongoEngine.prototype.checkSearchParam = ReactiveEngine.prototype.checkSearchParam;\nMinimongoEngine.prototype.transformSearchDefinition = ReactiveEngine.prototype.transformSearchDefinition;\n\nMinimongoEngine.prototype.getFindOptions = function (...args) {\n  let findOptions = MongoDBEngine.prototype.getFindOptions.apply(this, args);\n\n  findOptions.transform = this.config.transform;\n\n  return findOptions;\n};\n\nexport default MinimongoEngine;\n","import ReactiveEngine from '../core/reactive-engine';\nimport MongoDBEngine from './mongo-db';\n\n/**\n * The MongoTextIndexEngine lets you search the index with Mongo text indexes.\n *\n * @type {MongoTextIndexEngine}\n */\nclass MongoTextIndexEngine extends ReactiveEngine {\n  /**\n   * Return default configuration.\n   *\n   * @returns {Object}\n   */\n  defaultConfiguration() {\n    let mongoConfiguration = MongoDBEngine.defaultMongoConfiguration(this);\n\n    mongoConfiguration.selector = function (searchString) {\n      if (searchString.trim()) {\n        return { $text: { $search: searchString } };\n      }\n\n      return {};\n    };\n\n    return _.defaults({}, mongoConfiguration, super.defaultConfiguration());\n  }\n\n  /**\n   * Setup the index on creation.\n   *\n   * @param {Object} indexConfig Index configuration\n   */\n  onIndexCreate(indexConfig) {\n    super.onIndexCreate(indexConfig);\n\n    if (Meteor.isServer) {\n      let textIndexesConfig = {};\n\n      _.each(indexConfig.fields, function (field) {\n        textIndexesConfig[field] = 'text';\n      });\n\n      if (indexConfig.weights) {\n        textIndexesConfig.weights = options.weights();\n      }\n\n      indexConfig.collection._ensureIndex(textIndexesConfig);\n    }\n  }\n\n  /**\n   * Transform the search definition.\n   *\n   * @param {String|Object} searchDefinition Search definition\n   * @param {Object}        options          Search and index options\n   *\n   * @returns {Object}\n   */\n  transformSearchDefinition(searchDefinition, options) {\n    return searchDefinition;\n  }\n\n  /**\n   * Check the given search parameter for validity\n   *\n   * @param search\n   */\n  checkSearchParam(search) {\n    check(search, String);\n  }\n}\n\n// Explicitely inherit getSearchCursor method functionality\nMongoTextIndexEngine.prototype.getSearchCursor = MongoDBEngine.prototype.getSearchCursor;\nMongoTextIndexEngine.prototype.getFindOptions = MongoDBEngine.prototype.getFindOptions;\n\nexport default MongoTextIndexEngine;\n","import {\n  Index,\n  Engine,\n  ReactiveEngine,\n  Cursor,\n  MongoDBEngine,\n  MinimongoEngine,\n  MongoTextIndexEngine\n} from './main';\n\nEasySearch = {\n  // Core\n  Index,\n  Engine,\n  ReactiveEngine,\n  Cursor,\n  // Engines\n  MongoDB: MongoDBEngine,\n  Minimongo: MinimongoEngine,\n  MongoTextIndex: MongoTextIndexEngine\n};\n","import Index from './core/index';\nimport Engine from './core/engine';\nimport ReactiveEngine from './core/reactive-engine';\nimport Cursor from './core/cursor';\nimport MongoDBEngine from './engines/mongo-db';\nimport MinimongoEngine from './engines/minimongo';\nimport MongoTextIndexEngine from './engines/mongo-text-index';\n\nexport {\n  Index,\n  Engine,\n  ReactiveEngine,\n  Cursor,\n  MongoDBEngine,\n  MinimongoEngine,\n  MongoTextIndexEngine\n};\n"]}