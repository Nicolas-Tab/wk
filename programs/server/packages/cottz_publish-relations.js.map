{"version":3,"sources":["meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/index.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/handler_controller.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/methods.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/publish_relations.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/change_parent_doc.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/crossbar.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/cursor.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/index.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/join.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/observe.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/utils.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/nonreactive/cursor.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/nonreactive/index.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/nonreactive/join.js"],"names":["PublishRelations","module","link","default","v","exportDefault","export","HandlerController","_","constructor","handlers","set","handler","addBasic","collection","oldHandler","add","cursor","options","Error","description","_cursorDescription","collectionName","selector","newHandler","callbacks","stop","key","remove","_id","Meteor","check","Match","DDPServer","crossbar","_InvalidationCrossbar","methods","PR.changePagination","data","String","field","skip","Integer","fire","extend","id","connection","PR.fireListener","Object","CursorMethods","runSetters","name","callback","publish","cursors","_publicationName","onStop","_len","arguments","length","params","Array","_key","cb","apply","publishRelations","prototype","changeParentDoc","onRemoved","sub","result","_getCallbacks","added","doc","_addedWithCPD","changed","changes","removed","paginate","fieldData","limit","infinite","keys","copy","clone","max","connectionId","slice","listener","listen","run","omit","CursorMethodsNR","isString","_getCollectionName","applyCallback","method","isChanged","call","observeChanges","join","CursorJoin","sent","push","_len2","_ids","_key2","each","contains","_cursor","send","_selector","$in","isFunction","find","observe","getCB","cursorNonreactive","onAdded","forEach","joinNonreactive","CursorJoinNonreactive","_name","undefined","newIds"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAIA,gBAAgB;AAACC,MAAM,CAACC,IAAI,CAAC,qBAAqB,EAAC;EAACC,OAAOA,CAACC,CAAC,EAAC;IAACJ,gBAAgB,GAACI,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAACH,MAAM,CAACC,IAAI,CAAC,WAAW,CAAC;AAAnHD,MAAM,CAACI,aAAa,CAGLL,gBAHS,CAAC,C;;;;;;;;;;;ACAzBC,MAAM,CAACK,MAAM,CAAC;EAACH,OAAO,EAACA,CAAA,KAAII;AAAiB,CAAC,CAAC;AAAC,IAAIC,CAAC;AAACP,MAAM,CAACC,IAAI,CAAC,mBAAmB,EAAC;EAACM,CAACA,CAACJ,CAAC,EAAC;IAACI,CAAC,GAACJ,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAIpF,MAAMG,iBAAiB,CAAC;EACrCE,WAAWA,CAAA,EAAI;IACb,IAAI,CAACC,QAAQ,GAAG,CAAC,CAAC;EACpB;EACAC,GAAGA,CAAEC,OAAO,EAAE;IACZ,OAAO,IAAI,CAACA,OAAO,GAAGA,OAAO;EAC/B;EACAC,QAAQA,CAAEC,UAAU,EAAEF,OAAO,EAAE;IAC7B,MAAMG,UAAU,GAAG,IAAI,CAACL,QAAQ,CAACI,UAAU,CAAC;IAC5C,OAAOC,UAAU,KAAK,IAAI,CAACL,QAAQ,CAACI,UAAU,CAAC,GAAGF,OAAO,IAAI,IAAIL,iBAAiB,CAAC,CAAC,CAAC;EACvF;EACAS,GAAGA,CAAEC,MAAM,EAAEC,OAAO,EAAE;IACpB,IAAI,CAACD,MAAM,EACT,MAAM,IAAIE,KAAK,CAAC,+BAA+B,CAAC;IAElD,MAAMC,WAAW,GAAGH,MAAM,CAACI,kBAAkB;IAC7C,MAAMP,UAAU,GAAGI,OAAO,CAACJ,UAAU,IAAIM,WAAW,CAACE,cAAc;IACnE,MAAMC,QAAQ,GAAGH,WAAW,CAACG,QAAQ;IACrC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;IAII,MAAMC,UAAU,GAAGN,OAAO,CAACN,OAAO,GAChCK,MAAM,CAACC,OAAO,CAACN,OAAO,CAAC,CAACM,OAAO,CAACO,SAAS,CAAC,GAC1C,IAAIlB,iBAAiB,CAAC,CAAC;IAEzBiB,UAAU,CAACD,QAAQ,GAAGA,QAAQ;IAE9B,OAAO,IAAI,CAACb,QAAQ,CAACI,UAAU,CAAC,GAAGU,UAAU;EAC/C;EACAE,IAAIA,CAAA,EAAI;IACN,IAAIhB,QAAQ,GAAG,IAAI,CAACA,QAAQ;IAE5B,IAAI,CAACE,OAAO,IAAI,IAAI,CAACA,OAAO,CAACc,IAAI,CAAC,CAAC;IAEnC,KAAK,IAAIC,GAAG,IAAIjB,QAAQ,EAAE;MACxBA,QAAQ,CAACiB,GAAG,CAAC,CAACD,IAAI,CAAC,CAAC;IACtB;IAAC;IAED,IAAI,CAAChB,QAAQ,GAAG,EAAE;EACpB;EACAkB,MAAMA,CAAEC,GAAG,EAAE;IACX,IAAIjB,OAAO,GAAG,IAAI,CAACF,QAAQ,CAACmB,GAAG,CAAC;IAChC,IAAIjB,OAAO,EAAE;MACXA,OAAO,CAACc,IAAI,CAAC,CAAC;MACd,OAAO,IAAI,CAAChB,QAAQ,CAACmB,GAAG,CAAC;IAC3B;EACF;AACF,C;;;;;;;;;;;AC/DA,IAAIC,MAAM;AAAC7B,MAAM,CAACC,IAAI,CAAC,eAAe,EAAC;EAAC4B,MAAMA,CAAC1B,CAAC,EAAC;IAAC0B,MAAM,GAAC1B,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAAC,IAAI2B,KAAK,EAACC,KAAK;AAAC/B,MAAM,CAACC,IAAI,CAAC,cAAc,EAAC;EAAC6B,KAAKA,CAAC3B,CAAC,EAAC;IAAC2B,KAAK,GAAC3B,CAAC;EAAA,CAAC;EAAC4B,KAAKA,CAAC5B,CAAC,EAAC;IAAC4B,KAAK,GAAC5B,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAAC,IAAI6B,SAAS;AAAChC,MAAM,CAACC,IAAI,CAAC,mBAAmB,EAAC;EAAC+B,SAASA,CAAC7B,CAAC,EAAC;IAAC6B,SAAS,GAAC7B,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAIhO,MAAM8B,QAAQ,GAAGD,SAAS,CAACE,qBAAqB;AAEhDL,MAAM,CAACM,OAAO,CAAC;EACb,qBAAqBC,CAAEC,IAAI,EAAE;IAC3BP,KAAK,CAACO,IAAI,EAAE;MACVT,GAAG,EAAEU,MAAM;MACXC,KAAK,EAAED,MAAM;MACbE,IAAI,EAAET,KAAK,CAACU;IACd,CAAC,CAAC;IAEFR,QAAQ,CAACS,IAAI,CAACnC,CAAC,CAACoC,MAAM,CAAC;MACrB9B,UAAU,EAAE,aAAa;MACzB+B,EAAE,EAAE,IAAI,CAACC,UAAU,CAACD;IACtB,CAAC,EAAEP,IAAI,CAAC,CAAC;EACX,CAAC;EACD,iBAAiBS,CAAEjC,UAAU,EAAEI,OAAO,EAAE;IACtCa,KAAK,CAACjB,UAAU,EAAEyB,MAAM,CAAC;IACzBR,KAAK,CAACb,OAAO,EAAE8B,MAAM,CAAC;IAEtBd,QAAQ,CAACS,IAAI,CAACnC,CAAC,CAACoC,MAAM,CAAC;MACrB9B,UAAU,EAAE,SAAS,GAAGA,UAAU;MAClC+B,EAAE,EAAE,IAAI,CAACC,UAAU,CAACD;IACtB,CAAC,EAAE3B,OAAO,CAAC,CAAC;EACd;AACF,CAAC,CAAC,C;;;;;;;;;;;AC5BFjB,MAAM,CAACK,MAAM,CAAC;EAACN,gBAAgB,EAACA,CAAA,KAAIA;AAAgB,CAAC,CAAC;AAAC,IAAI8B,MAAM;AAAC7B,MAAM,CAACC,IAAI,CAAC,eAAe,EAAC;EAAC4B,MAAMA,CAAC1B,CAAC,EAAC;IAAC0B,MAAM,GAAC1B,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAAC,IAAIG,iBAAiB;AAACN,MAAM,CAACC,IAAI,CAAC,sBAAsB,EAAC;EAACC,OAAOA,CAACC,CAAC,EAAC;IAACG,iBAAiB,GAACH,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAAC,IAAI6C,aAAa;AAAChD,MAAM,CAACC,IAAI,CAAC,UAAU,EAAC;EAACC,OAAOA,CAACC,CAAC,EAAC;IAAC6C,aAAa,GAAC7C,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAI9RH,MAAA,CAAAiD,UAAA,CAAAlD,gBAAgB,GAAG,SAAAA,CAAUmD,IAAI,EAAEC,QAAQ,EAAE;EAC3C,OAAOtB,MAAM,CAACuB,OAAO,CAACF,IAAI,EAAE,YAAqB;IAC/C,IAAIvC,OAAO,GAAG,IAAIL,iBAAiB,CAAC,CAAC;MACrC+C,OAAO,GAAG,IAAIL,aAAa,CAAC,IAAI,EAAErC,OAAO,CAAC;IAE1C,IAAI,CAAC2C,gBAAgB,GAAGJ,IAAI;IAC5B,IAAI,CAACK,MAAM,CAAC,MAAM5C,OAAO,CAACc,IAAI,CAAC,CAAC,CAAC;IAAC,SAAA+B,IAAA,GAAAC,SAAA,CAAAC,MAAA,EALKC,MAAM,OAAAC,KAAA,CAAAJ,IAAA,GAAAK,IAAA,MAAAA,IAAA,GAAAL,IAAA,EAAAK,IAAA;MAANF,MAAM,CAAAE,IAAA,IAAAJ,SAAA,CAAAI,IAAA;IAAA;IAO7C,IAAIC,EAAE,GAAGX,QAAQ,CAACY,KAAK,CAACxD,CAAC,CAACoC,MAAM,CAACU,OAAO,EAAE,IAAI,CAAC,EAAEM,MAAM,CAAC;IACxD;IACA;IACA,OAAOG,EAAE;EACX,CAAC,CAAC;AACJ,CAAC;AAEDjC,MAAM,CAACmC,gBAAgB,GAAGjE,gBAAgB;AAnB1CC,MAAM,CAACI,aAAa,CAqBLL,gBArBS,CAAC,C;;;;;;;;;;;ACAzB,IAAIiD,aAAa;AAAChD,MAAM,CAACC,IAAI,CAAC,UAAU,EAAC;EAACC,OAAOA,CAACC,CAAC,EAAC;IAAC6C,aAAa,GAAC7C,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AACzE;AACA;AACA;AACA6C,aAAa,CAACiB,SAAS,CAACC,eAAe,GAAG,UAAUlD,MAAM,EAAEQ,SAAS,EAAE2C,SAAS,EAAE;EAChF,MAAMC,GAAG,GAAG,IAAI,CAACA,GAAG;EACpB,MAAMxC,GAAG,GAAG,IAAI,CAACA,GAAG;EACpB,MAAMf,UAAU,GAAG,IAAI,CAACA,UAAU;EAElC,IAAIwD,MAAM,GAAG,IAAI;EAEjB,IAAI,CAACzC,GAAG,IAAI,CAACf,UAAU,EACrB,MAAM,IAAIK,KAAK,CAAC,2DAA2D,CAAC;EAE9EM,SAAS,GAAG,IAAI,CAAC8C,aAAa,CAAC9C,SAAS,EAAE2C,SAAS,CAAC;EAEpD,IAAI,CAACxD,OAAO,CAACI,GAAG,CAACC,MAAM,EAAE;IACvBL,OAAO,EAAE,gBAAgB;IACzBa,SAAS,EAAE;MACT+C,KAAKA,CAAE3B,EAAE,EAAE4B,GAAG,EAAE;QACdH,MAAM,CAACI,aAAa,GAAGjD,SAAS,CAAC+C,KAAK,CAAC3B,EAAE,EAAE4B,GAAG,CAAC;MACjD,CAAC;MACDE,OAAOA,CAAE9B,EAAE,EAAE4B,GAAG,EAAE;QAChB,IAAIG,OAAO,GAAGnD,SAAS,CAACkD,OAAO,CAAC9B,EAAE,EAAE4B,GAAG,CAAC;QACxC,IAAIG,OAAO,EACTP,GAAG,CAACM,OAAO,CAAC7D,UAAU,EAAEe,GAAG,EAAE+C,OAAO,CAAC;MACzC,CAAC;MACDC,OAAOA,CAAEhC,EAAE,EAAE;QACX,IAAI+B,OAAO,GAAGnD,SAAS,CAACoD,OAAO,CAAChC,EAAE,CAAC;QACnC,IAAI+B,OAAO,EACTP,GAAG,CAACM,OAAO,CAAC7D,UAAU,EAAEe,GAAG,EAAE+C,OAAO,CAAC;MACzC;IACF;EACF,CAAC,CAAC;EAEF,OAAON,MAAM,CAACI,aAAa,IAAI,CAAC,CAAC;AACnC,CAAC,C;;;;;;;;;;;ACpCD,IAAIlE,CAAC;AAACP,MAAM,CAACC,IAAI,CAAC,mBAAmB,EAAC;EAACM,CAACA,CAACJ,CAAC,EAAC;IAACI,CAAC,GAACJ,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAAC,IAAI6C,aAAa;AAAChD,MAAM,CAACC,IAAI,CAAC,UAAU,EAAC;EAACC,OAAOA,CAACC,CAAC,EAAC;IAAC6C,aAAa,GAAC7C,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAAC,IAAI6B,SAAS;AAAChC,MAAM,CAACC,IAAI,CAAC,mBAAmB,EAAC;EAAC+B,SAASA,CAAC7B,CAAC,EAAC;IAAC6B,SAAS,GAAC7B,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAI3M,MAAM8B,QAAQ,GAAGD,SAAS,CAACE,qBAAqB;AAChD;AACA;AACAc,aAAa,CAACiB,SAAS,CAACY,QAAQ,GAAG,UAAUC,SAAS,EAAEC,KAAK,EAAEC,QAAQ,EAAE;EACvE,MAAMZ,GAAG,GAAG,IAAI,CAACA,GAAG;EACpB,MAAMvD,UAAU,GAAG,IAAI,CAACA,UAAU;EAElC,IAAI,CAAC,IAAI,CAACe,GAAG,IAAI,CAACf,UAAU,EAC1B,MAAM,IAAIK,KAAK,CAAC,2DAA2D,CAAC;EAE9E,MAAMqB,KAAK,GAAGQ,MAAM,CAACkC,IAAI,CAACH,SAAS,CAAC,CAAC,CAAC,CAAC;EACvC,MAAMI,IAAI,GAAG3E,CAAC,CAAC4E,KAAK,CAACL,SAAS,CAAC,CAACvC,KAAK,CAAC;EACtC,MAAM6C,GAAG,GAAGF,IAAI,CAACxB,MAAM;EACvB,MAAM2B,YAAY,GAAGjB,GAAG,CAACvB,UAAU,CAACD,EAAE;EAEtCkC,SAAS,CAACvC,KAAK,CAAC,GAAG2C,IAAI,CAACI,KAAK,CAAC,CAAC,EAAEP,KAAK,CAAC;EAEvC,MAAMQ,QAAQ,GAAGtD,QAAQ,CAACuD,MAAM,CAAC;IAC/B3E,UAAU,EAAE,aAAa;IACzB+B,EAAE,EAAEyC;EACN,CAAC,EAAGhD,IAAI,IAAK;IACX,IAAI,CAACA,IAAI,CAACO,EAAE,IAAIP,IAAI,CAACO,EAAE,KAAKyC,YAAY,EAAE;IAE1C,IAAI7C,IAAI,GAAGH,IAAI,CAACG,IAAI;IAEpB,IAAIA,IAAI,IAAI4C,GAAG,IAAI,CAACJ,QAAQ,EAC1B;IAEFF,SAAS,CAACvC,KAAK,CAAC,GAAGyC,QAAQ,GAAGE,IAAI,CAACI,KAAK,CAAC,CAAC,EAAE9C,IAAI,CAAC,GAAE0C,IAAI,CAACI,KAAK,CAAC9C,IAAI,EAAEA,IAAI,GAAGuC,KAAK,CAAC;IACjFX,GAAG,CAACM,OAAO,CAAC7D,UAAU,EAAEwB,IAAI,CAACT,GAAG,EAAEkD,SAAS,CAAC;EAC9C,CAAC,CAAC;EAEF,IAAI,CAACnE,OAAO,CAACC,QAAQ,CAAC2B,KAAK,EAAEgD,QAAQ,CAAC;EAEtC,OAAOT,SAAS,CAACvC,KAAK,CAAC;AACzB,CAAC;AAEDS,aAAa,CAACiB,SAAS,CAACuB,MAAM,GAAG,UAAUvE,OAAO,EAAEkC,QAAQ,EAAEsC,GAAG,EAAE;EACjE,MAAMrB,GAAG,GAAG,IAAI,CAACA,GAAG;EACpB,MAAMlB,IAAI,GAAG,SAAS,GAAG,IAAI,CAACI,gBAAgB;EAE9C,MAAMiC,QAAQ,GAAGtD,QAAQ,CAACuD,MAAM,CAAC;IAC/B3E,UAAU,EAAEqC,IAAI;IAChBN,EAAE,EAAEwB,GAAG,CAACvB,UAAU,CAACD;EACrB,CAAC,EAAGP,IAAI,IAAK;IACX,IAAI,CAACA,IAAI,CAACO,EAAE,IAAIP,IAAI,CAACO,EAAE,KAAKwB,GAAG,CAACvB,UAAU,CAACD,EAAE,EAAE;IAE/CrC,CAAC,CAACoC,MAAM,CAAC1B,OAAO,EAAEV,CAAC,CAACmF,IAAI,CAACrD,IAAI,EAAE,YAAY,EAAE,IAAI,CAAC,CAAC;IACnDc,QAAQ,CAAC,KAAK,CAAC;EACjB,CAAC,CAAC;EAEF,MAAMxC,OAAO,GAAG,IAAI,CAACA,OAAO,CAACC,QAAQ,CAACsC,IAAI,CAAC;EAE3C,IAAIuC,GAAG,KAAK,KAAK,EAAEtC,QAAQ,CAAC,IAAI,CAAC;EAEjC,OAAOxC,OAAO,CAACD,GAAG,CAAC6E,QAAQ,CAAC;AAC9B,CAAC,C;;;;;;;;;;;AC5DDvF,MAAM,CAACK,MAAM,CAAC;EAACH,OAAO,EAACA,CAAA,KAAI8C;AAAa,CAAC,CAAC;AAAC,IAAIzC,CAAC;AAACP,MAAM,CAACC,IAAI,CAAC,mBAAmB,EAAC;EAACM,CAACA,CAACJ,CAAC,EAAC;IAACI,CAAC,GAACJ,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAAC,IAAIwF,eAAe;AAAC3F,MAAM,CAACC,IAAI,CAAC,eAAe,EAAC;EAACC,OAAOA,CAACC,CAAC,EAAC;IAACwF,eAAe,GAACxF,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAGnK,MAAM6C,aAAa,SAAS2C,eAAe,CAAC;EACzDnF,WAAWA,CAAE4D,GAAG,EAAEzD,OAAO,EAAEiB,GAAG,EAAEf,UAAU,EAAE;IAC1C,KAAK,CAACuD,GAAG,CAAC;IAEV,IAAI,CAACzD,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACiB,GAAG,GAAGA,GAAG;IACd,IAAI,CAACf,UAAU,GAAGA,UAAU;EAC9B;EACAG,MAAMA,CAAEA,MAAM,EAAEH,UAAU,EAAEW,SAAS,EAAE;IACrC,MAAM4C,GAAG,GAAG,IAAI,CAACA,GAAG;IAEpB,IAAI,CAAC7D,CAAC,CAACqF,QAAQ,CAAC/E,UAAU,CAAC,EAAE;MAC3BW,SAAS,GAAGX,UAAU;MACtBA,UAAU,GAAGG,MAAM,CAAC6E,kBAAkB,CAAC,CAAC;IAC1C;IAEA,MAAMlF,OAAO,GAAG,IAAI,CAACA,OAAO,CAACI,GAAG,CAACC,MAAM,EAAE;MAACH,UAAU,EAAEA;IAAU,CAAC,CAAC;IAClE;IACA;;IAEA,IAAIW,SAAS,EACXA,SAAS,GAAG,IAAI,CAAC8C,aAAa,CAAC9C,SAAS,CAAC;IAE3C,SAASsE,aAAaA,CAAElD,EAAE,EAAE4B,GAAG,EAAEuB,MAAM,EAAE;MACvC,MAAMjC,EAAE,GAAGtC,SAAS,IAAIA,SAAS,CAACuE,MAAM,CAAC;MAEzC,IAAIjC,EAAE,EAAE;QACN,IAAI3B,OAAO,GAAG,IAAIa,aAAa,CAACoB,GAAG,EAAEzD,OAAO,CAACC,QAAQ,CAACgC,EAAE,CAAC,EAAEA,EAAE,EAAE/B,UAAU,CAAC;UAC1EmF,SAAS,GAAGD,MAAM,KAAK,SAAS;QAEhC,OAAOjC,EAAE,CAACmC,IAAI,CAAC9D,OAAO,EAAES,EAAE,EAAE4B,GAAG,EAAEwB,SAAS,CAAC,IAAIxB,GAAG;MACpD,CAAC,MACC,OAAOA,GAAG;IACd;IAAC;IAED,IAAI0B,cAAc,GAAGlF,MAAM,CAACkF,cAAc,CAAC;MACzC3B,KAAKA,CAAE3B,EAAE,EAAE4B,GAAG,EAAE;QACdJ,GAAG,CAACG,KAAK,CAAC1D,UAAU,EAAE+B,EAAE,EAAEkD,aAAa,CAAClD,EAAE,EAAE4B,GAAG,EAAE,OAAO,CAAC,CAAC;MAC5D,CAAC;MACDE,OAAOA,CAAE9B,EAAE,EAAE4B,GAAG,EAAE;QAChBJ,GAAG,CAACM,OAAO,CAAC7D,UAAU,EAAE+B,EAAE,EAAEkD,aAAa,CAAClD,EAAE,EAAE4B,GAAG,EAAE,SAAS,CAAC,CAAC;MAChE,CAAC;MACDI,OAAOA,CAAEhC,EAAE,EAAE;QACX,IAAIpB,SAAS,EAAE;UACbA,SAAS,CAACoD,OAAO,CAAChC,EAAE,CAAC;UACrBjC,OAAO,CAACgB,MAAM,CAACiB,EAAE,CAAC;QACpB;QAEAwB,GAAG,CAACQ,OAAO,CAAC/D,UAAU,EAAE+B,EAAE,CAAC;MAC7B;IACF,CAAC,CAAC;IAEF,OAAOjC,OAAO,CAACD,GAAG,CAACwF,cAAc,CAAC;EACpC;AACF;AAAC,C;;;;;;;;;;;ACzDD,IAAIlD,aAAa;AAAChD,MAAM,CAACC,IAAI,CAAC,UAAU,EAAC;EAACC,OAAOA,CAACC,CAAC,EAAC;IAAC6C,aAAa,GAAC7C,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAACH,MAAM,CAACC,IAAI,CAAC,QAAQ,CAAC;AAACD,MAAM,CAACC,IAAI,CAAC,WAAW,CAAC;AAACD,MAAM,CAACC,IAAI,CAAC,qBAAqB,CAAC;AAACD,MAAM,CAACC,IAAI,CAAC,YAAY,CAAC;AAACD,MAAM,CAACC,IAAI,CAAC,SAAS,CAAC;AAA5MD,MAAM,CAACI,aAAa,CAOL4C,aAPS,CAAC,C;;;;;;;;;;;ACAzB,IAAIzC,CAAC;AAACP,MAAM,CAACC,IAAI,CAAC,mBAAmB,EAAC;EAACM,CAACA,CAACJ,CAAC,EAAC;IAACI,CAAC,GAACJ,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAAC,IAAI6C,aAAa;AAAChD,MAAM,CAACC,IAAI,CAAC,UAAU,EAAC;EAACC,OAAOA,CAACC,CAAC,EAAC;IAAC6C,aAAa,GAAC7C,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAG9H6C,aAAa,CAACiB,SAAS,CAACkC,IAAI,GAAG,YAAqB;EAAA,SAAA3C,IAAA,GAAAC,SAAA,CAAAC,MAAA,EAARC,MAAM,OAAAC,KAAA,CAAAJ,IAAA,GAAAK,IAAA,MAAAA,IAAA,GAAAL,IAAA,EAAAK,IAAA;IAANF,MAAM,CAAAE,IAAA,IAAAJ,SAAA,CAAAI,IAAA;EAAA;EAChD,OAAO,IAAIuC,UAAU,CAAC,IAAI,EAAE,GAAGzC,MAAM,CAAC;AACxC,CAAC;AAED,MAAMyC,UAAU,CAAC;EACf5F,WAAWA,CAAE2B,OAAO,EAAEtB,UAAU,EAAEI,OAAO,EAAEiC,IAAI,EAAE;IAC/C,IAAI,CAACf,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACtB,UAAU,GAAGA,UAAU;IAC5B,IAAI,CAACI,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACiC,IAAI,GAAGA,IAAI;IAEhB,IAAI,CAACb,IAAI,GAAG,EAAE;IACd,IAAI,CAACgE,IAAI,GAAG,KAAK;EACnB;EACAC,IAAIA,CAAA,EAAW;IACb,IAAI5B,OAAO;IAAC,SAAA6B,KAAA,GAAA9C,SAAA,CAAAC,MAAA,EADL8C,IAAI,OAAA5C,KAAA,CAAA2C,KAAA,GAAAE,KAAA,MAAAA,KAAA,GAAAF,KAAA,EAAAE,KAAA;MAAJD,IAAI,CAAAC,KAAA,IAAAhD,SAAA,CAAAgD,KAAA;IAAA;IAGXlG,CAAC,CAACmG,IAAI,CAACF,IAAI,EAAE5E,GAAG,IAAI;MAClB,IAAI,CAACA,GAAG,IAAIrB,CAAC,CAACoG,QAAQ,CAAC,IAAI,CAACtE,IAAI,EAAET,GAAG,CAAC,EACpC;MAEF,IAAI,CAACS,IAAI,CAACiE,IAAI,CAAC1E,GAAG,CAAC;MACnB8C,OAAO,GAAG,IAAI;IAChB,CAAC,CAAC;IAEF,IAAI,IAAI,CAAC2B,IAAI,IAAI3B,OAAO,EACtB,OAAO,IAAI,CAACkC,OAAO,CAAC,CAAC;EACzB;EACAC,IAAIA,CAAA,EAAI;IACN,IAAI,CAACR,IAAI,GAAG,IAAI;IAChB,IAAI,CAAC,IAAI,CAAChE,IAAI,CAACqB,MAAM,EAAE;IAEvB,OAAO,IAAI,CAACkD,OAAO,CAAC,CAAC;EACvB;EACAE,SAASA,CAAA,EAAI;IACX,IAAIlF,GAAG,GAAG;MAACmF,GAAG,EAAE,IAAI,CAAC1E;IAAI,CAAC;IAC1B,OAAO9B,CAAC,CAACyG,UAAU,CAAC,IAAI,CAAC1F,QAAQ,CAAC,GAAG,IAAI,CAACA,QAAQ,CAACM,GAAG,CAAC,GAAE;MAACA,GAAG,EAAEA;IAAG,CAAC;EACrE;EACAgF,OAAOA,CAAA,EAAI;IACT,OAAO,IAAI,CAACzE,OAAO,CAACnB,MAAM,CAAC,IAAI,CAACH,UAAU,CAACoG,IAAI,CAAC,IAAI,CAACH,SAAS,CAAC,CAAC,EAAE,IAAI,CAAC7F,OAAO,CAAC,EAAE,IAAI,CAACiC,IAAI,CAAC;EAC7F;AACF;AAAC,C;;;;;;;;;;;AC5CD,IAAIF,aAAa;AAAChD,MAAM,CAACC,IAAI,CAAC,UAAU,EAAC;EAACC,OAAOA,CAACC,CAAC,EAAC;IAAC6C,aAAa,GAAC7C,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAEzE6C,aAAa,CAACiB,SAAS,CAACiD,OAAO,GAAG,UAAUlG,MAAM,EAAEQ,SAAS,EAAE;EAC7D,IAAI,CAACb,OAAO,CAACI,GAAG,CAACC,MAAM,EAAE;IACvBL,OAAO,EAAE,SAAS;IAClBa,SAAS,EAAEA;EACb,CAAC,CAAC;AACJ,CAAC;AAEDwB,aAAa,CAACiB,SAAS,CAACiC,cAAc,GAAG,UAAUlF,MAAM,EAAEQ,SAAS,EAAE;EACpE,IAAI,CAACb,OAAO,CAACI,GAAG,CAACC,MAAM,EAAE;IACvBL,OAAO,EAAE,gBAAgB;IACzBa,SAAS,EAAEA;EACb,CAAC,CAAC;AACJ,CAAC,C;;;;;;;;;;;ACdD,IAAIjB,CAAC;AAACP,MAAM,CAACC,IAAI,CAAC,mBAAmB,EAAC;EAACM,CAACA,CAACJ,CAAC,EAAC;IAACI,CAAC,GAACJ,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAAC,IAAI6C,aAAa;AAAChD,MAAM,CAACC,IAAI,CAAC,UAAU,EAAC;EAACC,OAAOA,CAACC,CAAC,EAAC;IAAC6C,aAAa,GAAC7C,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAG9H,SAASgH,KAAKA,CAAErD,EAAE,EAAEiC,MAAM,EAAE;EAC1B,IAAI5C,QAAQ,GAAGW,EAAE,CAACiC,MAAM,CAAC;EACzB,IAAI5C,QAAQ,IAAI,CAAC5C,CAAC,CAACyG,UAAU,CAAC7D,QAAQ,CAAC,EACrC,MAAM,IAAIjC,KAAK,CAAC6E,MAAM,GAAG,oCAAoC,CAAC;EAEhE,OAAO5C,QAAQ,IAAI,YAAY,CAAC,CAAC;AACnC;AAAC;AAEDH,aAAa,CAACiB,SAAS,CAACK,aAAa,GAAG,UAAUR,EAAE,EAAEK,SAAS,EAAE;EAC/D,IAAI5D,CAAC,CAACyG,UAAU,CAAClD,EAAE,CAAC,EAAE;IACpB,OAAO;MACLS,KAAK,EAAET,EAAE;MACTY,OAAO,EAAEZ,EAAE;MACXc,OAAO,EAAEuC,KAAK,CAAC;QAAChD,SAAS,EAAEA;MAAS,CAAC,EAAE,WAAW;IACpD,CAAC;EACH;EAEA,OAAO;IACLI,KAAK,EAAE4C,KAAK,CAACrD,EAAE,EAAE,OAAO,CAAC;IACzBY,OAAO,EAAEyC,KAAK,CAACrD,EAAE,EAAE,SAAS,CAAC;IAC7Bc,OAAO,EAAEuC,KAAK,CAACrD,EAAE,EAAE,SAAS;EAC9B,CAAC;AACH,CAAC,C;;;;;;;;;;;ACzBD9D,MAAM,CAACK,MAAM,CAAC;EAACH,OAAO,EAACA,CAAA,KAAIyF;AAAe,CAAC,CAAC;AAAC,IAAIpF,CAAC;AAACP,MAAM,CAACC,IAAI,CAAC,mBAAmB,EAAC;EAACM,CAACA,CAACJ,CAAC,EAAC;IAACI,CAAC,GAACJ,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAElF,MAAMwF,eAAe,CAAC;EACnCnF,WAAWA,CAAE4D,GAAG,EAAE;IAChB,IAAI,CAACA,GAAG,GAAGA,GAAG;EAChB;EACAgD,iBAAiBA,CAAEpG,MAAM,EAAEH,UAAU,EAAEwG,OAAO,EAAE;IAC9C,MAAMjD,GAAG,GAAG,IAAI,CAACA,GAAG;IAEpB,IAAI,CAAC7D,CAAC,CAACqF,QAAQ,CAAC/E,UAAU,CAAC,EAAE;MAC3BwG,OAAO,GAAGxG,UAAU;MACpBA,UAAU,GAAGG,MAAM,CAAC6E,kBAAkB,CAAC,CAAC;IAC1C;IACA,IAAI,CAACtF,CAAC,CAACyG,UAAU,CAACK,OAAO,CAAC,EACxBA,OAAO,GAAG,SAAAA,CAAA,EAAY,CAAC,CAAC;IAE1BrG,MAAM,CAACsG,OAAO,CAAE9C,GAAG,IAAK;MACtB,IAAI5C,GAAG,GAAG4C,GAAG,CAAC5C,GAAG;MACjBwC,GAAG,CAACG,KAAK,CAAC1D,UAAU,EAAEe,GAAG,EAAEyF,OAAO,CAACpB,IAAI,CAAC,IAAIN,eAAe,CAACvB,GAAG,CAAC,EAAExC,GAAG,EAAE4C,GAAG,CAAC,IAAIA,GAAG,CAAC;IACrF,CAAC,CAAC;EACJ;AACF;AAAC,C;;;;;;;;;;;ACrBD,IAAImB,eAAe;AAAC3F,MAAM,CAACC,IAAI,CAAC,UAAU,EAAC;EAACC,OAAOA,CAACC,CAAC,EAAC;IAACwF,eAAe,GAACxF,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAACH,MAAM,CAACC,IAAI,CAAC,QAAQ,CAAC;AAAnGD,MAAM,CAACI,aAAa,CAGLuF,eAHS,CAAC,C;;;;;;;;;;;ACAzB,IAAIpF,CAAC;AAACP,MAAM,CAACC,IAAI,CAAC,mBAAmB,EAAC;EAACM,CAACA,CAACJ,CAAC,EAAC;IAACI,CAAC,GAACJ,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAAC,IAAIwF,eAAe;AAAC3F,MAAM,CAACC,IAAI,CAAC,UAAU,EAAC;EAACC,OAAOA,CAACC,CAAC,EAAC;IAACwF,eAAe,GAACxF,CAAC;EAAA;AAAC,CAAC,EAAC,CAAC,CAAC;AAGlIwF,eAAe,CAAC1B,SAAS,CAACsD,eAAe,GAAG,YAAqB;EAAA,SAAA/D,IAAA,GAAAC,SAAA,CAAAC,MAAA,EAARC,MAAM,OAAAC,KAAA,CAAAJ,IAAA,GAAAK,IAAA,MAAAA,IAAA,GAAAL,IAAA,EAAAK,IAAA;IAANF,MAAM,CAAAE,IAAA,IAAAJ,SAAA,CAAAI,IAAA;EAAA;EAC7D,OAAO,IAAI2D,qBAAqB,CAAC,IAAI,CAACpD,GAAG,EAAE,GAAGT,MAAM,CAAC;AACvD,CAAC;AAED,MAAM6D,qBAAqB,CAAC;EAC1BhH,WAAWA,CAAE4D,GAAG,EAAEvD,UAAU,EAAEI,OAAO,EAAEiC,IAAI,EAAE;IAC3C,IAAI,CAACkB,GAAG,GAAGA,GAAG;IACd,IAAI,CAACvD,UAAU,GAAGA,UAAU;IAC5B,IAAI,CAACI,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACiC,IAAI,GAAGA,IAAI,IAAIrC,UAAU,CAAC4G,KAAK;IAEpC,IAAI,CAACpF,IAAI,GAAG,EAAE;IACd,IAAI,CAACgE,IAAI,GAAG,KAAK;EACnB;EACAS,SAASA,CAAA,EAA0B;IAAA,IAAxBlF,GAAG,GAAA6B,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAiE,SAAA,GAAAjE,SAAA,MAAG;MAACsD,GAAG,EAAE,IAAI,CAAC1E;IAAI,CAAC;IAC/B,OAAO9B,CAAC,CAACyG,UAAU,CAAC,IAAI,CAAC1F,QAAQ,CAAC,GAAG,IAAI,CAACA,QAAQ,CAACM,GAAG,CAAC,GAAE;MAACA,GAAG,EAAEA;IAAG,CAAC;EACrE;EACA0E,IAAIA,CAAA,EAAW;IACb,IAAIqB,MAAM,GAAG,EAAE;IAAC,SAAApB,KAAA,GAAA9C,SAAA,CAAAC,MAAA,EADT8C,IAAI,OAAA5C,KAAA,CAAA2C,KAAA,GAAAE,KAAA,MAAAA,KAAA,GAAAF,KAAA,EAAAE,KAAA;MAAJD,IAAI,CAAAC,KAAA,IAAAhD,SAAA,CAAAgD,KAAA;IAAA;IAGXlG,CAAC,CAACmG,IAAI,CAACF,IAAI,EAAE5E,GAAG,IAAI;MAClB,IAAI,CAACA,GAAG,IAAIrB,CAAC,CAACoG,QAAQ,CAAC,IAAI,CAACtE,IAAI,EAAET,GAAG,CAAC,EACpC;MAEF,IAAI,CAACS,IAAI,CAACiE,IAAI,CAAC1E,GAAG,CAAC;MACnB+F,MAAM,CAACrB,IAAI,CAAC1E,GAAG,CAAC;IAClB,CAAC,CAAC;IAEF,IAAI,IAAI,CAACyE,IAAI,IAAIsB,MAAM,CAACjE,MAAM,EAC5B,OAAO,IAAI,CAACa,KAAK,CAACoD,MAAM,CAACjE,MAAM,GAAG,CAAC,GAAG;MAACqD,GAAG,EAAEY;IAAM,CAAC,GAAEA,MAAM,CAAC,CAAC,CAAC,CAAC;EACnE;EACAd,IAAIA,CAAA,EAAI;IACN,IAAI,CAACR,IAAI,GAAG,IAAI;IAChB,IAAI,CAAC,IAAI,CAAChE,IAAI,CAACqB,MAAM,EAAE;IAEvB,OAAO,IAAI,CAACa,KAAK,CAAC,CAAC;EACrB;EACAA,KAAKA,CAAE3C,GAAG,EAAE;IACV,IAAI,CAACf,UAAU,CAACoG,IAAI,CAAC,IAAI,CAACH,SAAS,CAAClF,GAAG,CAAC,EAAE,IAAI,CAACX,OAAO,CAAC,CAACqG,OAAO,CAAC9C,GAAG,IAAI;MACrE,IAAI,CAACJ,GAAG,CAACG,KAAK,CAAC,IAAI,CAACrB,IAAI,EAAEsB,GAAG,CAAC5C,GAAG,EAAErB,CAAC,CAACmF,IAAI,CAAClB,GAAG,EAAE,KAAK,CAAC,CAAC;IACxD,CAAC,CAAC;EACJ;AACF;AAAC,C","file":"/packages/cottz_publish-relations.js","sourcesContent":["import PublishRelations from './publish_relations';\nimport './methods';\n\nexport default PublishRelations;","import { _ } from 'meteor/underscore';\n// The aim of handler Controller is to keep all observers that can be created within methods\n// its structure is very simple, has a 'handlers' object containing all observers children and\n// the observer father is stored within 'handler'\nexport default class HandlerController {\n  constructor () {\n    this.handlers = {};\n  }\n  set (handler) {\n    return this.handler = handler;\n  }\n  addBasic (collection, handler) {\n    const oldHandler = this.handlers[collection];\n    return oldHandler || (this.handlers[collection] = handler || new HandlerController());\n  }\n  add (cursor, options) {\n    if (!cursor)\n      throw new Error(\"you're not sending the cursor\");\n\n    const description = cursor._cursorDescription;\n    const collection = options.collection || description.collectionName;\n    const selector = description.selector;\n    /*\n      the selector uses references, in cases that a selector has objects inside\n      this validation isn't gonna work\n\n    let oldHandler = this.handlers[collection];\n    if (oldHandler) {\n      // when the selector equals method stops running, no change occurs and everything\n      // will still work properly without running the same observer again\n      oldHandler.equalSelector = _.isEqual(oldHandler.selector, selector);\n      if (oldHandler.equalSelector)\n        return oldHandler;\n\n      oldHandler.stop();\n    }*/\n\n    const newHandler = options.handler\n    ? cursor[options.handler](options.callbacks)\n    : new HandlerController();\n\n    newHandler.selector = selector;\n\n    return this.handlers[collection] = newHandler;\n  }\n  stop () {\n    let handlers = this.handlers;\n\n    this.handler && this.handler.stop();\n\n    for (let key in handlers) {\n      handlers[key].stop();\n    };\n\n    this.handlers = [];\n  }\n  remove (_id) {\n    let handler = this.handlers[_id];\n    if (handler) {\n      handler.stop();\n      delete this.handlers[_id];\n    }\n  }\n}","import { Meteor } from 'meteor/meteor';\nimport { check, Match } from 'meteor/check';\nimport { DDPServer } from 'meteor/ddp-server';\n\nconst crossbar = DDPServer._InvalidationCrossbar;\n\nMeteor.methods({\n  'PR.changePagination' (data) {\n    check(data, {\n      _id: String,\n      field: String,\n      skip: Match.Integer\n    });\n\n    crossbar.fire(_.extend({\n      collection: 'paginations',\n      id: this.connection.id\n    }, data));\n  },\n  'PR.fireListener' (collection, options) {\n    check(collection, String);\n    check(options, Object);\n\n    crossbar.fire(_.extend({\n      collection: 'listen-' + collection,\n      id: this.connection.id,\n    }, options));\n  }\n});","import { Meteor } from 'meteor/meteor';\nimport HandlerController from './handler_controller';\nimport CursorMethods from './cursor';\n\nPublishRelations = function (name, callback) {\n  return Meteor.publish(name, function (...params) {\n    let handler = new HandlerController(),\n    cursors = new CursorMethods(this, handler);\n\n    this._publicationName = name;\n    this.onStop(() => handler.stop());\n\n    let cb = callback.apply(_.extend(cursors, this), params);\n    // kadira show me alerts when I use this return (but works well)\n    // return cb || (!this._ready && this.ready());\n    return cb;\n  });\n};\n\nMeteor.publishRelations = PublishRelations;\n\nexport default PublishRelations;\nexport { PublishRelations };","import CursorMethods from './cursor';\n// DEPRECATED\n// designed to change something in the master document while the callbacks are executed\n// changes to the document are sent to the main document with the return of the callbacks\nCursorMethods.prototype.changeParentDoc = function (cursor, callbacks, onRemoved) {\n  const sub = this.sub;\n  const _id = this._id;\n  const collection = this.collection;\n\n  let result = this;\n\n  if (!_id || !collection)\n    throw new Error(\"you can't use this method without being within a document\");\n\n  callbacks = this._getCallbacks(callbacks, onRemoved);\n\n  this.handler.add(cursor, {\n    handler: 'observeChanges',\n    callbacks: {\n      added (id, doc) {\n        result._addedWithCPD = callbacks.added(id, doc);\n      },\n      changed (id, doc) {\n        var changes = callbacks.changed(id, doc);\n        if (changes)\n          sub.changed(collection, _id, changes);\n      },\n      removed (id) {\n        var changes = callbacks.removed(id);\n        if (changes)\n          sub.changed(collection, _id, changes);\n      }\n    }\n  });\n\n  return result._addedWithCPD || {};\n};","import { _ } from 'meteor/underscore';\nimport CursorMethods from './cursor';\nimport { DDPServer } from 'meteor/ddp-server';\n\nconst crossbar = DDPServer._InvalidationCrossbar;\n// designed to paginate a list, works in conjunction with the methods\n// do not call back to the main callback, only the array is changed in the collection\nCursorMethods.prototype.paginate = function (fieldData, limit, infinite) {\n  const sub = this.sub;\n  const collection = this.collection;\n\n  if (!this._id || !collection)\n    throw new Error(\"you can't use this method without being within a document\");\n\n  const field = Object.keys(fieldData)[0];\n  const copy = _.clone(fieldData)[field];\n  const max = copy.length;\n  const connectionId = sub.connection.id;\n\n  fieldData[field] = copy.slice(0, limit);\n\n  const listener = crossbar.listen({\n    collection: 'paginations',\n    id: connectionId,\n  }, (data) => {\n    if (!data.id || data.id !== connectionId) return;\n\n    let skip = data.skip;\n\n    if (skip >= max && !infinite)\n      return;\n\n    fieldData[field] = infinite ? copy.slice(0, skip): copy.slice(skip, skip + limit);\n    sub.changed(collection, data._id, fieldData);\n  });\n\n  this.handler.addBasic(field, listener);\n\n  return fieldData[field];\n};\n\nCursorMethods.prototype.listen = function (options, callback, run) {\n  const sub = this.sub;\n  const name = 'listen-' + this._publicationName;\n\n  const listener = crossbar.listen({\n    collection: name,\n    id: sub.connection.id\n  }, (data) => {\n    if (!data.id || data.id !== sub.connection.id) return;\n\n    _.extend(options, _.omit(data, 'collection', 'id'));\n    callback(false);\n  });\n\n  const handler = this.handler.addBasic(name);\n\n  if (run !== false) callback(true);\n\n  return handler.set(listener);\n};","import { _ } from 'meteor/underscore';\nimport CursorMethodsNR from './nonreactive';\n\nexport default class CursorMethods extends CursorMethodsNR {\n  constructor (sub, handler, _id, collection) {\n    super(sub);\n\n    this.handler = handler;\n    this._id = _id;\n    this.collection = collection;\n  }\n  cursor (cursor, collection, callbacks) {\n    const sub = this.sub;\n\n    if (!_.isString(collection)) {\n      callbacks = collection;\n      collection = cursor._getCollectionName();\n    }\n\n    const handler = this.handler.add(cursor, {collection: collection});\n    // if (handler.equalSelector)\n    //   return handler;\n\n    if (callbacks)\n      callbacks = this._getCallbacks(callbacks);\n\n    function applyCallback (id, doc, method) {\n      const cb = callbacks && callbacks[method];\n\n      if (cb) {\n        let methods = new CursorMethods(sub, handler.addBasic(id), id, collection),\n        isChanged = method === 'changed';\n\n        return cb.call(methods, id, doc, isChanged) || doc;\n      } else\n        return doc;\n    };\n\n    let observeChanges = cursor.observeChanges({\n      added (id, doc) {\n        sub.added(collection, id, applyCallback(id, doc, 'added'));\n      },\n      changed (id, doc) {\n        sub.changed(collection, id, applyCallback(id, doc, 'changed'));\n      },\n      removed (id) {\n        if (callbacks) {\n          callbacks.removed(id);\n          handler.remove(id);\n        }\n\n        sub.removed(collection, id);\n      }\n    });\n\n    return handler.set(observeChanges);\n  }\n};","import CursorMethods from './cursor';\nimport './join';\nimport './observe';\nimport './change_parent_doc';\nimport './crossbar';\nimport './utils';\n\nexport default CursorMethods;","import { _ } from 'meteor/underscore';\nimport CursorMethods from './cursor';\n\nCursorMethods.prototype.join = function (...params) {\n  return new CursorJoin(this, ...params);\n};\n\nclass CursorJoin {\n  constructor (methods, collection, options, name) {\n    this.methods = methods;\n    this.collection = collection;\n    this.options = options;\n    this.name = name;\n\n    this.data = [];\n    this.sent = false;\n  }\n  push (..._ids) {\n    let changed;\n\n    _.each(_ids, _id => {\n      if (!_id || _.contains(this.data, _id))\n        return;\n\n      this.data.push(_id);\n      changed = true;\n    });\n\n    if (this.sent && changed)\n      return this._cursor();\n  }\n  send () {\n    this.sent = true;\n    if (!this.data.length) return;\n\n    return this._cursor();\n  }\n  _selector () {\n    let _id = {$in: this.data};\n    return _.isFunction(this.selector) ? this.selector(_id): {_id: _id};\n  }\n  _cursor () {\n    return this.methods.cursor(this.collection.find(this._selector(), this.options), this.name);\n  }\n};","import CursorMethods from './cursor';\n\nCursorMethods.prototype.observe = function (cursor, callbacks) {\n  this.handler.add(cursor, {\n    handler: 'observe',\n    callbacks: callbacks\n  });\n};\n\nCursorMethods.prototype.observeChanges = function (cursor, callbacks) {\n  this.handler.add(cursor, {\n    handler: 'observeChanges',\n    callbacks: callbacks\n  });\n};","import { _ } from 'meteor/underscore';\nimport CursorMethods from './cursor';\n\nfunction getCB (cb, method) {\n  var callback = cb[method];\n  if (callback && !_.isFunction(callback))\n    throw new Error(method + ' should be a function or undefined');\n\n  return callback || function () {};\n};\n\nCursorMethods.prototype._getCallbacks = function (cb, onRemoved) {\n  if (_.isFunction(cb)) {\n    return {\n      added: cb,\n      changed: cb,\n      removed: getCB({onRemoved: onRemoved}, 'onRemoved')\n    };\n  }\n\n  return {\n    added: getCB(cb, 'added'),\n    changed: getCB(cb, 'changed'),\n    removed: getCB(cb, 'removed')\n  };\n};","import { _ } from 'meteor/underscore';\n\nexport default class CursorMethodsNR {\n  constructor (sub) {\n    this.sub = sub;\n  }\n  cursorNonreactive (cursor, collection, onAdded) {\n    const sub = this.sub;\n\n    if (!_.isString(collection)) {\n      onAdded = collection;\n      collection = cursor._getCollectionName();\n    }\n    if (!_.isFunction(onAdded))\n      onAdded = function () {};\n\n    cursor.forEach((doc) => {\n      let _id = doc._id;\n      sub.added(collection, _id, onAdded.call(new CursorMethodsNR(sub), _id, doc) || doc);\n    });\n  }\n};","import CursorMethodsNR from './cursor';\nimport './join';\n\nexport default CursorMethodsNR;","import { _ } from 'meteor/underscore';\nimport CursorMethodsNR from './cursor';\n\nCursorMethodsNR.prototype.joinNonreactive = function (...params) {\n  return new CursorJoinNonreactive(this.sub, ...params);\n};\n\nclass CursorJoinNonreactive {\n  constructor (sub, collection, options, name) {\n    this.sub = sub;\n    this.collection = collection;\n    this.options = options;\n    this.name = name || collection._name;\n\n    this.data = [];\n    this.sent = false;\n  }\n  _selector (_id = {$in: this.data}) {\n    return _.isFunction(this.selector) ? this.selector(_id): {_id: _id};\n  }\n  push (..._ids) {\n    let newIds = [];\n\n    _.each(_ids, _id => {\n      if (!_id || _.contains(this.data, _id))\n        return;\n\n      this.data.push(_id);\n      newIds.push(_id);\n    });\n\n    if (this.sent && newIds.length)\n      return this.added(newIds.length > 1 ? {$in: newIds}: newIds[0]);\n  }\n  send () {\n    this.sent = true;\n    if (!this.data.length) return;\n\n    return this.added();\n  }\n  added (_id) {\n    this.collection.find(this._selector(_id), this.options).forEach(doc => {\n      this.sub.added(this.name, doc._id, _.omit(doc, '_id'));\n    });\n  }\n};"]}